# Команды Django

[Источник](https://djbook.ru/rel1.9/ref/django-admin.html#check-appname-appname)

| Команда                                     | Описание                                                                                                                                |
| ------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------- |
| `python manage.py check`                    | Проверить проект на ошибки                                                                                                              |
| django-admin compilemessages                |                                                                                                                                         |
| django-admin createcachetable               |                                                                                                                                         |
| django-admin dbshell                        |                                                                                                                                         |
| django-admin diffsettings                   |                                                                                                                                         |
| dumpdata                                    |                                                                                                                                         |
| `python manage.py flush --database <ИмяБд>` | Отчистить данные из указанную БД. `<ИмяБд>` брать из `proj/settings.py->DATABASES{}`                                                    |
| `python manage.py inspectdb`                | Получить все модели БД в консоль                                                                                                        |
| loaddata                                    |                                                                                                                                         |
| makemessages                                |                                                                                                                                         |
| `python manage.py makemigrations <app>`     | Создать у приложения миграцию БД. Без аргументов создает миграции БД у всех приложений                                                  |
| `python manage.py migrate <app>`            | Синхронизирует состояние базы данных, с текущим состоянием миграций.                                                                    |
| `ptrhon manage.py runserver <HOST>:<PORT>`  | Запустить Django сервер. `<HOST>:<PORT>` необязательно                                                                                  |
| sendtestemail                               |                                                                                                                                         |
| `python manage.py shell`                    | Запускает интерактивный интерпретатор Python. Можно использовать `-i bpython`, но его нужно установить в ВО.                            |
| showmigrations                              |                                                                                                                                         |
| sqlflush                                    |                                                                                                                                         |
| sqlmigrate                                  |                                                                                                                                         |
| sqlsequencereset                            |                                                                                                                                         |
| squashmigrations                            |                                                                                                                                         |
| `python manage.py startapp <ИмяПриложения>` | Создать приложение по шаблону `/venv/lib/python3.9/site-packages/django/conf/app_template`. Не забудьте его добавить в `INSTALLED_APPS` |
| `django-admin startproject <ИмяПриложения>` | Создать проект по шаблону `/venv/lib/python3.9/site-packages/django/conf/project_template`.                                             |
| test                                        |                                                                                                                                         |
| testserver                                  |                                                                                                                                         |
| `python manage.py collectstatic`            | Скопировать все статические файлы из приложений в папку указанную в `proj/settings.py->STATIC_ROOT`                                     |

# Про проект

## Структура проекта

### Общая структура

- `<Name_proj>`

    - `asgi.py` = Для настройки хостинга(для новых проектов)
    - `settings.py` = Глобальные настройки проекта
    - `urls.py`= **URL** маршрутизаци
    - `wsgi.py` = Для настройки хостинга(для старых проектов)

- `<Name_app>` = Стороннее Приложение

    - `migrations` = миграции БД. (Структура Бд)
        - `0001_initial.py` = Варианты мигарции БД
    - `templates` = Шаблоны
        - `<Name_app>` = Имя должно совпадать с именем приложения
            - `name.html`
    - `static` = Статические данные
        - `<Name_app>`
            - `css`
                - `name.css`
            - `js`
                - `name.js`
            - `img`
                - `name.png`
    - `admin.py` = Связь с админ панелью сайта
    - `apps.py`= Настройки конфигурирования текущего приложения
    - `models.py `= Хранение ORM моделей
    - `test.py` = Тесты
    - `views.py` = Хранение представлений -`urls.py`= Список URL в котором храниться все пути приложения, а потом уже расширяют главный
    - `Name_proj/urls.py`

- `templates` =Общие шаблоны проекта. Добавить в `<proj>/settings.py->TEMPLATES->'DIRS': [os.path.join(BASE_DIR, 'templates')],`
- `manage.py` = Файл нужен для управления проектом

---

### `views.py`= Логика web-приложения !!! Пагинация

В файле `views.py` приходят запросы или ответы от клиента, в этом файле нам нужно обработать эти данные, и передать их в шаблон `html`.

---

#### Функции представления

**Функции представления** = это простой способ настроить логику обработки `url` запроса. Функция представления всегда принимает первым аргументом`request`. [Источник](https://docs.djangoproject.com/en/3.2/topics/http/shortcuts/)

| Функции                                                                      | Описание                                                                                                  |
| ---------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------- |
| return HttpResponse(`content="<HtmlТекст>", status=200`)                     | Вернуть html текст                                                                                        |
| return render(`<request>, "<Путь_к_html_файлу>", contect=<Данные_в_шаблон>`) | Вернуть шаблонный файл html. Помните о том что сначала нужно указать имя приложения. Пример: `app/t.html` |
| return redirect(`<"ИменованыйUrl">`)                                         | Перенаправить на указанный именованный `URL`адрес. Код `302` - Временно перемещена                        |
| return redirect(`<"ИменованыйUrl">, permanent=True`)                         | Перенаправить на указанный именованный `URL`адрес. Код `301` - Постоянное перемещение                     |

---

Стандартный шаблон.

```python
def index_main(request: WSGIRequest):

    context = {} # Укзать какие данные нужно отправить в шаблон `html`

    return render(request,
                  template_name="ИмяПриложения/Имяфайла.html",
                  context=context, )
```

#### Классы представления

**Классы представления** = Классы представления это удобный механизм для создания логики обработке `http` запросов. К тому же, существует много готовых классов представления, которые помогают решать стандартные задачи.

---

Особенности Классов представления:

- В `urls.py` в функции `path`, нужно вызвать метод класса `$ИмяКлассаПредставления$.as_view()`
- [Введение в представления на основе классов](https://docs.djangoproject.com/en/3.2/topics/class-based-views/intro/)
- [Атрибуты и методы в классах представления](https://djbook.ru/rel1.9/ref/class-based-views/flattened-index.html)
- [Все классы представления](https://docs.djangoproject.com/en/3.2/ref/class-based-views/)
- [Видео урок про классы представления](https://www.youtube.com/watch?v=_0IDdU6PDJo)

---

| Класс представления | Описание                                                            | Краткое имя |
| ------------------- | ------------------------------------------------------------------- | ----------- |
| View                | Базовый класс для всех классов представления                        | vview       |
| DetailView          | Подробные данные о записи в БД. Принимает динамический `url` записи | vdetail     |
| ListView            | Класс для страницы с записями. Лего можно настроить пагинацию       | vlist       |
| CreateView          | Класс для создания записей в БД. Использует Модель-Форму            | vcreate     |

---

`View` = Базовый класс для всех классов представления.

```python
class $NameClass$(View):

    template_name = "$app$/$name_file$.html" # Путь к шаблону `html`
    http_method_names = ["get", "post",] # Список методов HTTP, которые обрабатывает класс.

    # model = $NameModel$ # Какую модель используем
    # queryset = $NameModel$.objects.$MethodModel$ # Получаем данные из БД


    def get(self, request: WSGIRequest):
        """
        В методе обрабатывается GET запрос
        request.method == "GET"
        """
        return render(request,
                      template_name=self.template_name,
                      context=self.get_context_data(), )

    def post(self, request: WSGIRequest, *args, **kwargs):
        """
        В методе обрабатывается POST запрос
        request.method == "POST"
        """
        ...

    def get_context_data(self, **kwargs) -> dict[str, Any]:
        """
        Сформировать контекст для шаблона `html`
        """
        context = {
            $END$
        }
        return context
```

---

`DetailView` = Подробные данные об одной записи из БД.

> В `urls.py` у функции `path` должен быть динамический `url` - либо `<int:pk>/`либо `<int:slug>/` которые ищется в БД
> , Чтобы переопределить имя динамического `url` используйте атрибут `slug_url_kwarg` для `slug`. `pk_url_kwarg` для `pk`

```python
class $NameClass$DetailView(DetailView):
    model = $NameModel$ # Какую модель используем
    queryset = $NameModel$.objects.$MethodModel$ # Получаем данные из БД
    template_name = "$app$/$name_file$.html" # Путь к шаблону `html`
    http_method_names = ["get", "post",] # Список методов HTTP, которые обрабатывает класс.
    context_object_name = "$NameClass$" # Для результата класса, Даем понятное имя переменой в шаблон.

    def get(self, request: WSGIRequest, *args, **kwargs):
        """
        В методе обрабатывается GET запрос

        request.method == "GET"
        print(request.GET)
        """

        resget = super().get(request, *args, **kwargs)
        return resget

    def post(self, request: WSGIRequest, *args, **kwargs):
        """
        В методе обрабатывается POST запрос

        request.method == "POST"
        """

        print(request.POST)

    def get_context_data(self, **kwargs) -> dict[str, Any]:
        """
        В этом методе формировать `context` для шаблон `html`
        :return: context
        """
        context = super().get_context_data(**kwargs)
        return context
```

---

`ListView` = Класс для страницы с записями. Лего можно настроить пагинацию.

- `allow_empty` = Логическое значение, указывающее, следует ли отображать страницу, если объекты отсутствуют. Если это `False`и нет доступных объектов, вид вызовет 404

```python
class $NameClass$ListView(ListView):
    model = $NameModel$ # Какую модель используем
    queryset = $NameModel$.objects.$MethodModel$ # Получаем данные из БД
    template_name = "$app$/$name_file$.html" # Путь к шаблону `html`
    http_method_names = ["get", "post",] # Список методов HTTP, которые обрабатывает класс.
    context_object_name = "$NameClass$" # Для результата класса, Даем понятное имя переменой в шаблон.
    allow_empty = False  # Отображать ошибку 404 если страница не найдена

    def get(self, request: WSGIRequest, *args, **kwargs):
        """
        В методе обрабатывается GET запрос

        request.method == "GET"
        print(request.GET)
        """

        resget = super().get(request, *args, **kwargs)
        return resget

    def post(self, request: WSGIRequest, *args, **kwargs):
        """
        В методе обрабатывается POST запрос

        request.method == "POST"
        """

        print(request.POST)

    def get_context_data(self, **kwargs) -> dict[str, Any]:
        """
        В этом методе формировать `context` для шаблон `html`
        :return: context
        """
        context = super().get_context_data(**kwargs)
        return context
```

---

`CreateView` = Класс для создания записей в БД. Использует Модель-Форму.

- `success_url` = URL-адрес для перенаправления после успешной обработки формы.

```python
class $NameClass$CreateView(CreateView):
    form_class = $ProductForm$ # Модель-формы
    template_name = "$app$/$name_file$.html" # Путь к шаблону `html`
    http_method_names = ["get", "post",] # Список методов HTTP, которые обрабатывает класс.
    success_url = reverse_lazy("$NameUrlRederect$")  # URL-адрес для перенаправления после успешной обработки формы.

    # model = $NameModel$ # Какую модель используем, по умолчанию берёт модель из `form_class`
    # context_object_name = "$NameClass$" # Для результата класса, Даем понятное имя переменой в шаблон.

    def get(self, request: WSGIRequest, *args, **kwargs):
        """
        В методе обрабатывается GET запрос

        request.method == "GfET"
        """
        resget = super().get(request, *args, **kwargs)
        return resget

    def post(self, request: WSGIRequest, *args, **kwargs):
        """
        В методе обрабатывается POST запрос

        request.method == "POST"
        """
        # Проверить данные, если они корректные то сохранить их в БД
        respost = super().post(request, *args, **kwargs)
        return respost

    def get_context_data(self, **kwargs) -> dict[str, Any]:
        """
        В этом методе формировать `context` для шаблона `html`

        :return: context
        """
        context = super().get_context_data(**kwargs)
        return context
```

### `settings.py` = Настройка всего проекта

В `settings.py` хранятся все глобальные настройки для проекта.

---

[Источник settings.py](https://docs.djangoproject.com/en/3.2/ref/settings/)

---

```python
# Полный путь к вашему проекту
BASE_DIR = Path(__file__).resolve().parent.parent
```

---

```python
# Секретный ключ, который нужно держать в  тайне
SECRET_KEY = 'django-insecure--)y-qf@jq$z2aog4%4f#4#vi)*6dhck0e^@%*yb6*1dh5n#@tm'
```

---

```python
# Если `True` будет отображать отладочную информацию
DEBUG = True
# Список хостов который будет обслуживать Django
ALLOWED_HOSTS = []
```

---

```python
# Все инсталлированные приложения на вашем сайте.
INSTALLED_APPS = [
	 'django.contrib.admin',
     'django.contrib.auth',
     'django.contrib.contenttypes',
     'django.contrib.sessions',
     'django.contrib.messages',
     'django.contrib.staticfiles',
]
```

> **При создании приложений, нужно добавлять его сюда**. Шаблон добавление приложения `"<name_app>.apps.<Name_app>Config",`

---

```bush
# Список плагинов.
MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

```

---

```python
ROOT_URLCONF = '<proj>.urls' # Путь к основному urls.py

# Список, содержащий настройки для всех шаблонизаторов, которые будут использоваться с Джанго.
# Каждый элемент списка представляет собой словарь, содержащий параметры для индивидуального двигатель.
TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates', # Используемый шаблонный сервер.
        'DIRS': [os.path.join(BASE_DIR, 'templates')], # Каталоги, в которых движок должен искать исходные файлы шаблонов, в поиске порядок.
        'APP_DIRS': True, # Должен ли движок искать исходные файлы шаблонов внутри установленного Приложения.
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]
```

---

```python
# Словарь, содержащий настройки для всех баз данных, которые будут использоваться с Джанго.
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'app_name': BASE_DIR / 'db.sqlite3',
    }
}
```

---

```python
# Список валидаторов, которые используются для проверки надежности паролей пользователей.
AUTH_PASSWORD_VALIDATORS = [
    {
        'app_name': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'app_name': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'app_name': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'app_name': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]
```

---

```python
LANGUAGE_CODE = 'ru' # Язык сервера
USE_I18N = True # Логическое значение, указывающее, должна ли быть включена система перевода Django.
TIME_ZONE = 'UTC' #  Часовой пояс
USE_L10N = True # Логическое значение, указывающее, будет ли включено локализованное форматирование данны
USE_TZ = True # Логическое значение, указывающее, будут ли даты по умолчанию учитывать часовой пояс
```

---

```python
# Имя папки со статическими файлами
STATIC_URL = '/static/'

# Путь к общей статической папки. Обьеденить все статические файлы можно командой `python manage.py collectstatic`
STATIC_ROOT = BASE_DIR / STATIC_URL

# Список нестандартных путей используемых для сборки.
STATICFILES_DIRS = []
```

> Внимание **если у вас есть две папки** `static`, одна общая папка для всех, а другая в приложение, то данные будут **браться из папки приложения**

---

```python
DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField' # Автоматически добовлять поле primary_key к БД
```

---

### `urls.py` = Навигация по сайту

Файл `urls.py` производит маршрутизацию по запрошенным `URL`

#### Общие функции

[Источник](https://docs.djangoproject.com/en/3.2/ref/urls/)

```python
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
	path('admin/', admin.site.urls),
	path('<Путь>', include('<main_app>.url')),
]
```

| Функция                                       | Url                                        | Описание                                                                                 |
| --------------------------------------------- | ------------------------------------------ | ---------------------------------------------------------------------------------------- |
| path(`'admin/', admin.site.urls`)             | `http://127.0.0.1:8000/admin`              | Обработчик URL. Пример `url` обработчика админ панели                                    |
| path(`'<Путь>', include('<main_app>.url')`)   | `http://127.0.0.1:8000/<Путь>`             | Дописывать к URL приложению указанный `<Путь>`                                           |
| path(`'<Путь>/<int:NAME_ID>/, ...`)',         | `http://127.0.0.1:8000/<Путь>/123`         | Динамические параметры для URL запроса, `NAME_ID` будет передан в функцию представления  |
| re_path(`r'<Путь>/(?P<name>pattern)/', ... `) | `http://127.0.0.1:8000/<Путь>/<параметер>` | Используя регулярные выражения, можно создавать свои правила для обработчика URL запроса |

---

#### Динамические парамеры у URL запроса.

```python
from django.contrib import admin
from django.http import HttpResponse
from django.urls import path, include, re_path

urlpatterns = [
    path('cats/<int:NAME_ID>/', lambda request, NAME_ID: HttpResponse(f"{request.GET}{NAME_ID}")),
    re_path(r'^archive/(?P<year>[0-9]{4})/', lambda request, year: HttpResponse(f"{request.GET}{year}")),
]

```

> В регулярных выражениях Python синтаксис именованных групп регулярных выражений является `(?P<name>pattern)`, куда `name`это название группы и `pattern`это какой-то шаблон для сопоставления. [Источник](https://djbook.ru/rel3.0/topics/http/urls.html)

Кроме использования `int` в динамических параметрах URL. Можно использовать:

| Ключевое слово | Описание                             |
| -------------- | ------------------------------------ |
| `int`          | Любое положительное число            |
| `str`          | Любая не пустая строка, исключая `/` |
| `slug`         | Символы `ASCII`,`-`,`_`              |
| `uuid`         | Цифры, нижний регистр `ASCII`,`-`    |
| `path`         | Любая не пустая строка, включая `/`  |

---

#### Именованные URL адреса

[Источник](https://docs.djangoproject.com/en/3.2/topics/http/urls/#reverse-resolution-of-urls)

Для простого редиректа и навигации, лучше задавать имена к `URL` адресам. Для этого в функции `path`/`re_path` установите имя для аргумента `name`, после этого Django будет сам устанавливать полный путь к `url` адресу

```python
#`app.urls.py`
urlpatterns = [
    path('', index, name="home"),  		# http://127.0.0.1:8000/app/
    path('test1', test_1),  			# http://127.0.0.1:8000/app/test1
]
```

```python
#`app.urls.py`
def test_1(request):
    if True:
        return redirect('home')
    return HttpResponse(f"{str(request.GET)}test_1")
```

После этого мы можем обращаться к этим именованным `url` адресам:

| Где                   | Пример                                                                | Описание                                                   |
| --------------------- | --------------------------------------------------------------------- | ---------------------------------------------------------- |
| HTML шаблон           | `<a href="{% url '<ИмяURL>' %}"></a>`                                 | В html шаблонах                                            |
| HTML шаблон           | `<a href="{% url '<ИмяURL>' <ПараметрURL_1> <ПараметрURL_N> %}"></a>` | В html шаблоны можно также передавать параметры `URL`      |
| Функция представления |                                                                       |                                                            |
| Функция представления | `return redirect('<ИмяURL>')`                                         | Перенаправление на другую страницу                         |
| В методе модели БД.   | `return reverse_lazy('<ИмяURL>')`                                     | Перенаправляет без параметров                              |
| В методе модели БД.   | `return reverse("<ИмяURL>", kwargs={"<POST_ID>": <self.NAME>})`       | При перенаправлении можно также передавать параметры `URL` |

---

Пример `<a href="{% url '<ИмяURL>' <ПараметрURL_1> <ПараметрURL_N> %}"></a>`

`urls.py`

```python
from django.urls import path

from myapp.views import index_main

urlpatterns = [
    path('<int:name_id>/<int:name_id2>', index_main, name="home"),
]

```

`myapp/views.py`

```python
from django.core.handlers.wsgi import WSGIRequest
from django.shortcuts import render


# Create your views here.


def index_main(request: WSGIRequest, name_id, name_id2):
    context = {
        "name_id": name_id + 10,
        "name_id2": name_id2 + 10,
    }
    return render(request,
                  template_name="myapp/index_main.html",
                  context=context, )
```

`templates/myapp/index_main.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<a href="{% url 'home' name_id name_id2%}">LIN</a>

</body>
</html>
```

---

Пример `return reverse("<ИмяURL>", kwargs={"<POST_ID>": <self.NAME>})`. Если нам нужно брать `url` адрес из БД, то лучше определить для этого метод `get_absolute_url`

`myapp/model.py`

```python
from django.db import models

# Create your models here.
from django.urls import reverse


class TestDb(models.Model):
    name = models.TextField(db_column="Наименование товара")

    def __str__(self):
        """
        Для отображение в текстовом виде для админ панели, и консоли.
        """
        return str(self.pk)

    def get_absolute_url(self):
        """
        Для получения ссылки записи в Html и отображение в админ панели.
        """
        return reverse("ПримерURL", kwargs={"pk": self.pk})

    class Meta:
        """
        Вспомогательный класс для админ панели.
        """
        verbose_name = "TestDb"  # Имя таблицы в единственном числе
        verbose_name_plural = "TestDbs"  # Имя таблицы во множественном числе
        ordering = ["pk", ]  # Сортировать записи по указан ным столбцам (можно указывать несколько столбцов)
```

`myapp/views.py`

```python
from django.core.handlers.wsgi import WSGIRequest
from django.http import HttpResponse
from django.shortcuts import render

# Create your views here.
from myapp.models import TestDb


def home_fun(request: WSGIRequest, pk):
    return HttpResponse(f"{request.GET}{pk}")


def index_main(request: WSGIRequest):
    post = TestDb.objects.first()
    context = {
        "post": post,
    }
    return render(request,
                  template_name="myapp/index_main.html",
                  context=context, )

```

`myapp/urls.py`

```python
from django.urls import path

from myapp.views import index_main, home_fun

urlpatterns = [
    path('', index_main, name="home"),
    path('home/<int:pk>', home_fun, name="ПримерURL"),
]

```

`templates/myapp/index_main.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<a href="{{ post.get_absolute_url }}">LIN</a>

</body>
</html>
```

#### Обработка `Http` ошибок

Можно переопределять логику программы при возникновении `http` ошибок. [Список ошибок](https://ru.wikipedia.org/wiki/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D0%BA%D0%BE%D0%B4%D0%BE%D0%B2_%D1%81%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D1%8F_HTTP)

| Ошибка     | Описание                                                 |
| ---------- | -------------------------------------------------------- |
| handler400 | Некорректный запрос                                      |
| handler403 | Доступ к странице запрещен. (клиент не аутентифицирован) |
| handler404 | Страница не найдена                                      |
| handler500 | Ошибка сервера                                           |
|            |                                                          |

---

Пример переопределения ошибки. Обратите внимание, что обрабатывать исключения `http` лучше в `proj/urls.py`. Так ошибки могут возникать в разных `url` приложениях, и поэтому они могут не обработать их.

`proj/urls.py`

```python
from django.http import HttpResponseNotFound

urlpatterns = [ .. ]

handler404 = lambda request, exception: HttpResponse(f"Станица не найдена {exception}", status=404)
```

# Html шаблоны

## Введение

Все `html` документы для вашего приложения принято хранить в папке `ИмяПриложения/templates/ИмяПриложения`

---

Для удобства вы можете выбрать подцветку синтаксиса шаблонизатора. Если у вас полная версия, то вам будет доступен `Django`

![шаблон django](_attachments/da9011f81fbcc329514e858ffb8631f6.png)

---

Краткий обзор

| Внешний вид           | Название                                                                              |
| --------------------- | ------------------------------------------------------------------------------------- |
| `{% ИмяТега %}`       | Обращение к тегу                                                                      |
| `{{ ИмяПеременной }}` | Обращение к переменной. Нельзя давать имена начинающеюся с нижнего подчеркивания `_`. |

---

Все переменные переданные в шаблон `html` будут конвертированные в `str`. То есть при передаче в `html` шаблон `Django` будут вызвать метод класса `__str__()`. Пример:

```python
class Test:
    def __init__(self):
        self.name = (1, 2, 3)

    def __str__(self):
        return "Вызван метод __str__"
```

## Теги

[Все встроенные теги. Источник](https://docs.djangoproject.com/en/3.2/ref/templates/builtins/)

### `for`/`empty`/`cycle`/`if`/`elif`/`else`

---

Тег `for` работает как обычный цикл, он перебирает переданный итерируемый объект.

Пример одномерного массива

```html
{% for x in ИмяИтератора  %}
{{ x }}
{% endfor %}
```

Пример двумерного массива. **Нужно обращаться к индексу через точку `.`**

```html
{% for x in ИмяИтератора  %}
{{ x.0 }}{{ x.1 }}{{ x.2 }} <br>
{% endfor %}
```

Пример словаря. В шаблоне можно использовать такие же методы как и в `Python`, только их **не** нужно вызвать `()`

```html
{% for k,v in ИмяИтератора.items %}
    {{ k }}:{{ v }} <br>
{% endfor %}
```

Аналог `enumerate` это `{{ forloop.counter0 }}` [+](https://docs.djangoproject.com/en/3.2/ref/templates/builtins/#for)

```bush
{% for x in ИмяИтератора  %}
	{{ forloop.counter0 }} {{ x }}<br>
{% endfor %}
```

---

Тег `empty`. Это тег срабатывает если массив пустой.

```python
{% for v in ИмяИтератора.values %}
    {{ v }}
{% empty %}
    Извините но массив пустой
{% endfor %}

{#===#}

{% if ИмяИтератора %}
    {% for athlete in ИмяИтератора %}
        {{ v }}
    {% endfor %}
{% else %}
    Извините но массив пустой
{% endif %}
```

---

Тег `cycle`. Часто встречаются задачи когда нужно через раз дублировать шаблоны. Для это есть тег `cycle`

```html
{% for v in ИмяИтератора %}
    <span style="font-size:{% cycle 10 20 30 40 %}">
        {{ v }}
    </span>
{% endfor %}
```

- ![cycle](_attachments/432035a9ea5950676ca7035bf9b513fc.png)

---

Тег `if`/`elif`/`else` работает как обычный `if`/`elif`/`else`. Пример:

```html
{% if v > 2 %}
	...
{% elif v == 1 %}
	...
{% else %}
	...
{% endif %}
```

Также можно указать несколько условия.

```python
{% if v > 2 and v < 4 or not v == 0 %}
	{{ v }}
{% endif %}
```

### `block` / `extends` / `include`

#### Общее

`block` нужен для уменьшения дублирования когда, он это делает путем расширения html шаблонов.
Правописание `block`. Принято закрывать блок с тем же именем, с каким он создан.

```html
{% block NameBlock %}


{% endblock NameBlock %}
```

---

`extends` Нужен как раз для расширения шаблона. Блоки с одинаковыми именами будут наследоваться. Обратите внимание при `extends` в базовый шаблон добавляется только `block`, любой другой контент просто игнорируется и в базовый шаблон не добавляется.[ Про наследование шаблонов ](https://docs.djangoproject.com/en/3.2/ref/templates/language/#template-inheritance)

```html
{% extends "ИмяПриложения/ИмяБазовогоШаблона.html" %}
```

Добавить контент из базового блока, в блок наследника, можно путем вызова функции. `{{ block.super }}`.

```bush
{% block NameBlock %}
{{ block.super }}
{% endblock NameBlock %}
```

---

`include` = Нужен для простой вставки `html` контента, в разные другие `html`файлы. Правописание `include`:

```html
{% include  "ИмяПриложения/ИмяБазовогоШаблона.html"%}
```

---

#### Разбираем пример наследование шаблонов

`urls.py`

```python
from django.urls import path

from myapp.views import index_main, home_fun

urlpatterns = [
    path('', index_main, name="index"),
    path('home/', home_fun, name="home"),
]
```

`views.py`

```python
from django.core.handlers.wsgi import WSGIRequest
from django.shortcuts import render


def home_fun(request: WSGIRequest):
    context = {
    }
    return render(request,
                  template_name="myapp/chaild.html",
                  context=context, )


def index_main(request: WSGIRequest):
    context = {
    }
    return render(request,
                  template_name="myapp/index_main.html",
                  context=context, )
```

`index_main.html`

```html


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>Привет авантюрист</h1>

<a href="{% url 'index' %}">Index</a><br>
<a href="{% url 'home' %}">Home</a><br>

{% block NameBlock %}
    <h4>Главный текст</h4>
{% endblock NameBlock %}

</body>
</html>
```

`chaild.html`. Обратите внимание, что негде нет`Любой текст из chaild.html`

```html
{% extends "myapp/index_main.html" %}
Любой текст из chaild.html
{% block NameBlock %}
     {{ block.super }}
    <h4>Текст блока</h4>
    {% include  "myapp/new_content.html"%}
{% endblock NameBlock %}
```

> А вот пример того что `Любой текст из chaild.html` появился в `chaild.html`.
>
> ```python
> {#{% extends "myapp/index_main.html" %}#}
> Любой текст из chaild.html
> {% block NameBlock %}
> {#     {{ block.super }}#}
>
>     <h4>Текст блока</h4>
> {% endblock NameBlock %}
> ```

## Фильтры для переменных

[Список встроенных фильтров](https://djbook.ru/rel3.0/ref/templates/builtins.html#built-in-filter-reference)

| Фильтр                               | Описание                                                                                                   |
| ------------------------------------ | ---------------------------------------------------------------------------------------------------------- |
| `{{ value │ default:"nothing" }}`    | Установить значение по умолчанию                                                                           |
| `{{ value │ dictsort:"name" }}`      | Сортировка словаря                                                                                         |
| `{{ value │ first }}`                | Возвращает первый элемент списка                                                                           |
| `{{ value │ last }}`                 | Возвращает последний элемент списка                                                                        |
| `{{ value │ linenumbers }}`          | Отображает текст как нумерованный                                                                          |
| `{{ value │ ljust:"10" }}`           | Выравнивает значение влево в поле указанной ширины.                                                        |
| `{{ value │ random }}`               | Возвращает случайный элемент из списка                                                                     |
| `{{ some_list │ slice:":2" }}`       | Сделать слайс списка                                                                                       |
| `{{ value │ truncatewords:2 }}`      | Обрезать сроку до длины                                                                                    |
| `{{ var │ unordered_list }}`         | Создает элемент таблицы HTML (li) [+](https://djbook.ru/rel3.0/ref/templates/builtins.html#unordered-list) |
| `{{ value │ urlize }}`               | Делает из текста ссылку                                                                                    |
| `{{ value │ urlizetrunc:15 }}`       | Делает из текста ссылку, обрезает результат до указанной длинно                                            |
| `{{ value │ wordcount }}`            | Возвращает количество слов                                                                                 |
| `{ value │ yesno:"yeah,no,maybe" }}` | Преобразует булевые значение в понятные сообщения                                                          |
| `{{ value │ linebreaks }}`           | Ставит переносы строки в конец текста                                                                      |

## Подключение различных данных к `Html` документу

### Подключение статических файлов `css`/`js`/`img`

- Для подключения статических файлов убедитесь что у вас есть `proj/settings.py->STATIC_URL = '/static/'`
- Для сборки всех статических файлов убедитесь что у вас есть `proj/settings.py->STATIC_ROOT` и выполните команду `python manage.py collectstatic`
- Внимание **если у вас есть две папки** `static`, одна общая папка для всех, а другая в приложение, то данные будут **браться из папки приложения**
- Помните о том что браузеры кешируют статические файлы, поэтому для обновленных данных нужно **перезагружать страницу с отчисткой кеша**. Например, у вас это возможно клавиша `Crtl+F5`.
- Помните о том что статические файлы при `DEBUG=False` должны обрабатываться веб сервером, например `nginx`. Но мы можем для теста запустить проект через команду `python manage.py runserver --insecure` и все будет работать, но такой вариант не эффективен для релиза. [Подробнее](https://stackoverflow.com/questions/5836674/why-does-debug-false-setting-make-my-django-static-files-access-fail).

    ```python
    # После `python manage.py collectstatic` закоментируйте `STATIC_ROOT`
    STATIC_URL = '/static/'
    # STATIC_ROOT = os.path.join(BASE_DIR, "static")
    STATICFILES_DIRS = [
    	os.path.join(BASE_DIR, "static"),
    ]
    ```

Для работы со статическими фалами, нам нужно в самом вверх подключить тег `static`.

```html
{% load static %}
```

---

Подключить `css`

```html
<link href="{% static '$ИмяПриложения$/css/$ИмяФайла$.css' %}" rel="stylesheet" type="text/css">
```

---

Подключить `img`. Картинка может быть любым доступным форматом изображения, например`jpeg`/`png`/`svg`

```html
<img src="{% static '$ИмяПриложения$/img/$ИмяФайла$.png' %}">
```

---

### Подключить стороннее шрифты

Например, давайте подключим шрифты [МойОфис](https://myoffice.ru/products/fonts/).

1. Для этого нам нужно сказать архив, и достать файл с расширением `.ttf`.
2. Создать папку `ИмяПриложения/static/fonts` и поместить туда шрифты.
3. В файле `.css` нужно добавить правило. `font-family` имя по которому можно получить шрифт, `src` путь к шрифту. [Источник](https://developer.mozilla.org/ru/docs/Web/CSS/@font-face)
    ```css
    @font-face {
    	font-family: 'XO_Courser_Nu';
        src: url('../fonts/XO_Oriel_CN_Nu.ttf') ;
    }
    ```

---

Пример.

- `ИмяПриложения`
    - `static`
        - `css`
            - `main.css`
        - `fonts`
            - `XO_Oriel_CN_Nu.tff`
            - `XO_Courser_Nu.tff`

`main.css`

```css
.test {
    font-family: 'XO_Oriel_CN_Nu';

}

.test2 {
    font-family: 'XO_Courser_Nu';
}

@font-face {
    font-family: 'XO_Oriel_CN_Nu';
    src: url('../fonts/XO_Oriel_CN_Nu.ttf') ;
}

@font-face {
    font-family: 'XO_Courser_Nu';
    src: url('../fonts/XO_Courser_Nu.ttf') ;
}
```

### Подключаем `Bootstrap`

`Bootstrap` — свободный набор инструментов для создания сайтов и веб-приложений. Включает в себя HTML- и CSS-шаблоны оформления для типографики, веб-форм, кнопок, меток, блоков навигации и прочих компонентов веб-интерфейса, включая JavaScript-расширения. **Лицензия `MIT`**

---

Для простого и быстрого подключения `Bootstrap` скопируйте и вставьте таблицу стилей `<link>`в ваш `<head>`перед всеми остальными таблицами стилей для загрузки нашего CSS. [Источник с разными версиями Bootstrap](https://www.bootstrapcdn.com/)

```html
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
```

---

Полезные ссылки

- [Примеры стилей к элементам](https://bootstrap-4.ru/docs/4.0/components/progress/)

## Работа с формами

### Про `form`

- Все данные которые отправляются от клиента к серверу должны обрабатываться в `form` [Источник про form](http://htmlbook.ru/html/form).
- `Django` для нашей безопасности обязует чтобы форма имела `{% csrf_token %}`, это нужно для защиты от "Межсайтовая подделка запроса" - это значит что данные из одной формы не могут скрытно отправиться в другую форму, это достигается путем выдачи уникальных `token` для каждой формы.
- Ответ из формы `<form method="post">` будет храниться в `request.POST:dict`. При этом `request.method == "POST"`
- Ответ из формы `<form method="get">` будет храниться в `request.GET:dict`. При этом `request.method == "GET"`

| Атрибуты Form  | Описание                                                                                                                                   |
| -------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
| method         | Метод протокола HTTP. `get`/`post`                                                                                                         |
| name           | Определяет уникальное имя формы. Как правило, имя формы используется для доступа к ее элементам через скрипты.                             |
| action         | `URL` адрес в который отправиться результат из формы.                                                                                      |
| accept-charset | Кодировка символов `Windows-1251`, `UTF-8` и другие.                                                                                       |
| autocomplete   | Включает автозаполнение полей формы `on`/`off`                                                                                             |
| enctype        | Способ кодирования(не шифрования) данных формы. [Подробнее](http://htmlbook.ru/html/form/enctype)                                          |
| novalidate     | Если указать то отменяет встроенную верификацию данных формы.                                                                              |
| target         | Имя окна или фрейма, куда обработчик будет загружать возвращаемый результат. `_blank` в новом окне/`_self` в текущем окне/`_parent`/`_top` |

```html
<form method="post" name="MyForm"
      action=""
      accept-charset="UTF-8"
      autocomplete="on"
      target="_self"
      enctype="application/x-www-form-urlencoded"> {% csrf_token %}


</form>
```

---

### Теги для `form`

#### input

[Про input](http://htmlbook.ru/html/input)

| Атрибуты input | Описание                                                                                                                                                       |
| -------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| accept         | Устанавливает фильтр на типы файлов, которые вы можете отправить через поле загрузки файлов. `<input type="file">`                                             |
| accesskey      | Переход к элементу с помощью комбинации клавиш.                                                                                                                |
| align          |                                                                                                                                                                |
| alt            | Альтернативный текст для кнопки с изображением                                                                                                                 |
| autocomplete   | Включает автозаполнение полей формы `on`/`off`                                                                                                                 |
| autofocus      | Автоматически устанавливает фокус в поле формы. В таком поле можно сразу набирать текст без явного щелчка по нему курсором мыши.                               |
| border         |                                                                                                                                                                |
| checked        | Предварительно активированный переключатель или флажок для `type="radio"`/ `type="checkbox"`                                                                   |
| disabled       | Блокирует доступ и изменение поля формы.                                                                                                                       |
| form           |                                                                                                                                                                |
| formaction     |                                                                                                                                                                |
| formenctype    |                                                                                                                                                                |
| formmethod     |                                                                                                                                                                |
| formnovalidate |                                                                                                                                                                |
| formtarget     |                                                                                                                                                                |
| list           | Указывает на список вариантов, созданный с помощью тега `<datalist>`, которые можно выбирать при наборе текста. [Про list](http://htmlbook.ru/html/input/list) |
| max            | Устанавливает верхнее значение для ввода числа или даты в поле формы. `type="number"`/`type="range"`/`type="date"`                                             |
| maxlength      | Устанавливает максимальное число символов для поля `type="text"`/`type="password"`                                                                             |
| min            | Нижнее значение для ввода числа или даты. `type="number"`/`type="range"`/`type="date"`                                                                         |
| multiple       | Позволяет загрузить несколько файлов одновременно. `type="file"`/ `type="email"`                                                                               |
| name           | Имя поля, предназначено для того, чтобы обработчик формы мог его идентифицировать.                                                                             |
| pattern        | Указывает регулярное выражение, согласно которому требуется вводить и проверять данные в поле формы. Данные не отправятся пока форма не корректна              |
| placeholder    | Выводит подсказывающий текст.                                                                                                                                  |
| readonly       | Устанавливает, что поле не может изменяться пользователем.                                                                                                     |
| required       | Обязательное поле для заполнения.                                                                                                                              |
| size           | Сколько символом можно вместить в текстовое поле. `type="text"`/`type="password"`                                                                              |
| src            | Адрес графического файла для поля с изображением. `type="image"`                                                                                               |
| step           |                                                                                                                                                                |
| tabindex       | Определяет порядок перехода между элементами с помощью клавиши Tab.                                                                                            |
| value          | Значение элемента.                                                                                                                                             |
| type           | Сообщает браузеру, к какому типу относится элемент формы.                                                                                                      |

| `<input type="...">` | Описание                                                                                                                                                       |                                                                                                                                         |
| -------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------- |
| button               | Кнопка.                                                                                                                                                        | <input type="submit" value="Кнопка">                                                                                                    |
| checkbox             | Флажки. Позволяют выбрать более одного варианта из предложенных.                                                                                               | <input type="checkbox" > Вариант1 <input type="checkbox" > Вариант2 <input type="checkbox" >Вариант3                                    |
| file                 | Поле для ввода имени файла, который пересылается на сервер.                                                                                                    | <input type="file">                                                                                                                     |
| hidden               | Скрытое поле. Оно никак не отображается на веб-странице.                                                                                                       | <input type="hidden">                                                                                                                   |
| image                | Поле с изображением. При нажатии на рисунок данные формы отправляются на сервер.                                                                               | <input type="image" src="https://clck.ru/YUarz" width="64"  height="64" alt="Фото">                                                     |
| password             | Обычное текстовое поле, но отличается от него тем, что все символы показываются звездочками. Предназначено для того, чтобы никто не подглядел вводимый пароль. | <input type="password">                                                                                                                 |
| radio                | Переключатели. Используются, когда следует выбрать один вариант из нескольких предложенных.                                                                    | <input type="radio" name="nradio" val> Вариант1 <input type="radio" name="nradio"> Вариант2 <input type="radio"  name="nradio">Вариант3 |
| reset                | Кнопка для возвращения данных формы в первоначальное значение.                                                                                                 | <input type="reset">                                                                                                                    |
| submit               | Кнопка для отправки данных формы на сервер.                                                                                                                    | <input type="submit" >                                                                                                                  |
| text                 | Текстовое поле. Предназначено для ввода символов с помощью клавиатуры.                                                                                         | <input type="text">                                                                                                                     |
| color                | Виджет для выбора цвета.                                                                                                                                       | <input type="color" value="#ff0000">                                                                                                    |
| date                 | Поле для выбора календарной даты.                                                                                                                              | <input type="date">                                                                                                                     |
| datetime             | -local Указание местной даты и времени.                                                                                                                        | <input type="datetime-local">                                                                                                           |
| email                | Для адресов электронной почты.                                                                                                                                 | <input type="email">                                                                                                                    |
| number               | Ввод чисел.                                                                                                                                                    | <input type="number">                                                                                                                   |
| range                | Ползунок для выбора чисел в указанном диапазоне.                                                                                                               | <input type="range">                                                                                                                    |
| search               | Поле для поиска.                                                                                                                                               | <input type="search">                                                                                                                   |
| tel                  | Для телефонных номеров.                                                                                                                                        | <input type="tel" pattern="[0-9]{3}-[0-9]{2}-[0-9]{3}">                                                                                 |
| time                 | Для времени.                                                                                                                                                   | <input type="time">                                                                                                                     |
| url                  | Для веб-адресов.                                                                                                                                               | <input type="url">                                                                                                                      |
| month                | Выбор месяца.                                                                                                                                                  | <input type="month">                                                                                                                    |
| week                 | Выбор недели.                                                                                                                                                  | <input type="week">                                                                                                                     |

---

#### select

[Про select](http://htmlbook.ru/html/select)

| Атрибут   | Описание                                                                             |
| --------- | ------------------------------------------------------------------------------------ |
| accesskey | Позволяет перейти к списку с помощью некоторого сочетания клавиш.                    |
| autofocus | Устанавливает, что список получает фокус после загрузки страницы.                    |
| disabled  | Блокирует доступ и изменение элемента.                                               |
| form      | Связывает список с формой.                                                           |
| multiple  | Позволяет одновременно выбирать сразу несколько элементов списка.                    |
| name      | Имя элемента для отправки на сервер или обращения через скрипты.                     |
| required  | Список обязателен для выбора перед отправкой формы.                                  |
| size      | Количество отображаемых строк списка.                                                |
| tabindex  | Определяет последовательность перехода между элементами при нажатии на клавишу `Tab` |

<tr valign="top">
	<td align="center">
		<select name="select" size="3" multiple="multiple">
			<option selected="selected">Чебурашка
			</option><option>Крокодил Гена</option>
			<option>Шапокляк</option>
			<option>Крыса Лариса</option>
		</select>
	</td>
	<td align="center">
		<select name="select2">
			<option selected="selected">Выберите героя</option>
			<option>Чебурашка</option>
			<option>Крокодил Гена</option>
			<option>Шапокляк</option>
			<option>Крыса Лариса</option>
		</select>
	</td>
</tr>

#### button

`button` отличается от `<input type="button">` тем что в него можно вставлять различный контент(фотки,gif)

[Про button](http://htmlbook.ru/html/button/type)

| Тег           | Описание                                                                              |
| ------------- | ------------------------------------------------------------------------------------- |
| value         | Значение кнопки, которое будет отправлено на сервер или прочитано с помощью скриптов. |
| type="submit" | Отправить данные на сервер                                                            |

<form action="">
	<p><input type="text" name="user"></p>
	<p><button type="reset">Очистить форму <img src="https://clck.ru/YUarz" alt="Фото" width="64"  height="64">  </button> 
		<button type="submit">Отправить форму</button></p>
</form>

#### textarea

[Про textarea](http://htmlbook.ru/html/textarea)

| Атрибут     | Описание                                                                           |
| ----------- | ---------------------------------------------------------------------------------- |
| accesskey   | Переход к полю с помощью сочетания клавиш.                                         |
| autofocus   | Автоматическое получение фокуса.                                                   |
| cols        | Ширина поля в символах.                                                            |
| disabled    | Блокирует доступ и изменение элемента.                                             |
| form        | Связывает текстовое поле с формой по её идентификатору.                            |
| maxlength   | Максимальное число введенных символов.                                             |
| name        | Имя поля, предназначено для того, чтобы обработчик формы мог его идентифицировать. |
| placeholder | Указывает замещающийся текст.                                                      |
| readonly    | Устанавливает, что поле не может изменяться пользователем.                         |
| required    | Обязательное для заполнения поле.                                                  |
| rows        | Высота поля в строках текста.                                                      |
| tabindex    | Порядок перехода между элементами при нажатии на клавишу Tab.                      |
| wrap        | Параметры переноса строк.                                                          |

<form method="post">
	<p><b>Введите ваш отзыв:</b></p>
	<p><textarea rows="10" cols="45" name="text"></textarea></p>
	<p><input type="submit" value="Отправить"></p>
</form>

### ModelForm не связанные с БД

ModelForm не связанные с БД - относительно сложнее устроенны чем `html` формы. Поэтому лучше использовать легче использовать стандартные инструменты форм `html`

- [Формы не свзяннаые с моделью](https://www.youtube.com/watch?v=u37FXeVQIpU&t=873s)
- [Форма для добавления записей в БД](https://www.youtube.com/watch?v=8QnMxrNT0-8&list=PLDyJYA6aTY1nZ9fSGcsK4wqeu-xaJksQQ&index=12)

# Структура БД

В `Django` есть удобный инструмент для работы с БД, он использует принципы `ORM`. Класс в котором реализована логика работы базы данных, называется моделью БД, и соответственно эти классы должны храниться в файле `models.py`. Для того чтобы из ваших моделей создать реальные базы данных, нужно создать миграцию, а потом её применить.

> `Миграции` - это описание изменений, которые вы хотите внести в таблицы базы данных.

> `ORM`(объектно-реляционное отображение) = технология программирования, которая связывает базы данных с концепциями объектно-ориентированных языков программирования

```python
from django.db import models

# Create your models here.
from django.urls import reverse


class NameDataBase(models.Model):
	"""
	Место для столбцов таблицы. Создаются как статические атрибуты
	"""

    def __str__(self):
        """
        Для отображение в текстовом виде для админ панели, и консоли.
        """
        return str(self.pk)

    def get_absolute_url(self):
        """
        Для получения ссылки записи в Html и отображение в админ панели.
        """
        return reverse("#", kwargs={"": self.pk})

    class Meta:
        """
        Вспомогательный класс для админ панели.
        """
        verbose_name = "NameDataBase"  # Имя таблицы в единственном числе
        verbose_name_plural = "NameDataBases"  # Имя таблицы во множественном числе
        ordering = ["pk", ]  # Сортировать записи по указанным столбцам (можно указывать несколько столбцов)
```

## Поля для модели

[Источник](https://djbook.ru/rel3.0/ref/models/fields.html)

### Типы полей

| Тип поля                                             | Описание                                                                                                                                       | Краткое имя | Шаблон                                                                                                                             |
| ---------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------- | ----------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| CharField(`max_length=None`)                         | Поле для хранения строк указанной длинны.                                                                                                      | mchar       | `$name_var$ = models.CharField(max_length=$len$, db_column="$NameColumn$", verbose_name="$NameColumn$", help_text="$NameColumn$")` |
| TextField()                                          | Неограниченное текстовое поле                                                                                                                  | mtext       | `$name_var$ = models.TextField(db_column="$NameColumn$", verbose_name="$NameColumn$", help_text="$NameColumn$")`                   |
| DateField(`auto_now=False, auto_now_add=False,`)     | Для хранения только даты. `auto_now` авто обновления даты при изменении записи, `auto_now_add` авто установка текущей даты при создании записи | mdata       | `$name_var$ = models.DateField(db_column="$NameColumn$", verbose_name="$NameColumn$", help_text="$NameColumn$")`                   |
| DateTimeField(`auto_now=False, auto_now_add=False,`) | То же самое что `DateField`, плюс также хранит часы/минуты/секунды.                                                                            | mtime       | `$name_var$ = models.DateTimeField(db_column="$NameColumn$", verbose_name="$NameColumn$", help_text="$NameColumn$")`               |
| IntegerField()                                       | Число от -2147483648 - 2147483647                                                                                                              | mint        | `$name_var$ = models.IntegerField(db_column="$NameColumn$", verbose_name="$NameColumn$", help_text="$NameColumn$")`                |
| PositiveIntegerField()                               | Число от 0 - 2147483647                                                                                                                        | mpint       | `$name_var$ = models.PositiveIntegerField(db_column="$NameColumn$", verbose_name="$NameColumn$", help_text="$NameColumn$")`        |

### Общие параметры для полей модели БД

| Аргумент         | Описание                                                                                                                                |
| ---------------- | --------------------------------------------------------------------------------------------------------------------------------------- |
| `null`           | Пусто значение равно `NULL`                                                                                                             |
| `blank`          | Поле может быть пустым                                                                                                                  |
| `unique`         | Поля должно быть уникальным в своем столбце                                                                                             |
| `db_column`      | Имя колонки в базе данных.                                                                                                              |
| `verbose_name`   | Имя колонки в админ панели.                                                                                                             |
| `db_index`       | Индексировать столбец для быстрого поиска                                                                                               |
| `default`        | Значение по умолчанию, можно указать как переменную, так и функцию                                                                      |
| `editable`       | При `False`, поле не будет отображаться в админке                                                                                       |
| `error_messages` | Позволяет переопределить сообщения ошибки для поля                                                                                      |
| `help_text`      | Подсказка, отображаемая под полем в интерфейсе администратора. Это полезно для описания поля, даже если модель не используется в форме. |
| `primary_key`    | При `True` это поле будет первичным ключом.                                                                                             |
| `validators`     | Список валидаторов для поля                                                                                                             |

### Валидаторы для поля модели БД

Можно создавать свои валидаторы, для этого нужно вызвать исключение `ValidationError`
если данные не верны.

```python
from django.core.exceptions import ValidationError
from django.utils.translation import gettext_lazy as _
from django.db import models

def validate_even(value):
    if value % 2 != 0:
        raise ValidationError(
            _('%(value)s is not an even number'),
            params={'value': value},
        )

class MyModel(models.Model):
    even_field = models.IntegerField(validators=[validate_even])
```

---

Список стандартных валидаторов. [Валидаторы Django](https://djbook.ru/rel3.0/ref/validators.html#module-django.core.validators "Ссылка на этот заголовок")

| Название                                | Описание                    |
| --------------------------------------- | --------------------------- |
| `RegexValidator`                        | Регулярные выражения        |
| `EmailValidator`                        | Проверка корректности почты |
| `URLValidator`                          | Проверка корректности URL   |
| `validate_slug`                         | Только буквы цифры `-` `_`  |
| `validate_unicode_slug`                 |                             |
| `validate_ipv4_address`                 |                             |
| `validate_ipv6_address`                 |                             |
| `validate_ipv46_address`                |                             |
| `validate_comma_separated_integer_list` |                             |
| `int_list_validator`                    |                             |
| `MaxValueValidator`                     | Максимальное значение       |
| `MinValueValidator`                     | Минимальное значение        |
| `MaxLengthValidator`                    | Максимальная длина          |
| `MinLengthValidator`                    | Минимальная длина           |
| `DecimalValidator`                      |                             |
| `FileExtensionValidator`                |                             |
| `validate_image_file_extension`         |                             |
| `ProhibitNullCharactersValidator`       |                             |

## CRUD

### Create

### Read

- Чтение из базы данных ленивое, то есть мы считываем данные из БД только когда к ним обращаемся (в шаблоне или через цикл, и тд.).
- Ниже указанные методы, на самом деле генерируют `Sql` запросы в зависимости от БД которой вы используете.
- Для того чтобы хранить `Sql` запросы, и генерировать их, `Django` использует `QuerySet` [Про QuerySet](https://docs.djangoproject.com/en/3.2/ref/models/querysets/)

| Команда                                  | Описание                                                                             | Краткое имя | Шаблон                   |
| ---------------------------------------- | ------------------------------------------------------------------------------------ | ----------- | ------------------------ |
| `ВашаМодель`.objects.all() -> `QuerySet` | Получить все записи.                                                                 | dall        | `$db$.objects.all()`     |
| `QuerySet`.order_by(`"Колонка_1"`)       | Отсортировать по указанным колонкам. Знак `-` в начале сортирует в обратном порядке. | dsort       | `.order_by("$Column$",)` |
| `QuerySet`.values(`"Колонка_1"`)         | Взять только указанные колонки.                                                      | dval        | `.values("$Column$",)`   |
| `QuerySet`.[`start:stop:steep`]          | Используйте сайлы, для того чтобы ограничить количество выводимых записей            |             |                          |
|                                          |                                                                                      |             |                          |

### Upadate

### Delete

## Формы связанные с моделью БД

Если вам нужно создать форму для заполнения данных БД. То быстрее всего это сделать через формы `ModelForm` [+Все методы форм](https://docs.djangoproject.com/en/3.2/topics/forms/modelforms/).

Для начало на нужно создать файл `app/forms.py`. В нем буду храниться наши шаблоны форм.

```python
from typing import Tuple, Any

from django import forms
from django.core.handlers.wsgi import WSGIRequest

from .models import Product


class ProductForm(forms.ModelForm):

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)

        # Пример установки параметров поля. Во время создания формы
        # self.fields['Имя'].Атрибут = "Значение"

    class Meta:
        """
        Класс отвечает за логику связи модели БД с формой.
        """

        # Установить связь с моделью БД
        model = Product

        # Какие поля нужно отобразить в форме
        fields = [
            "name_product",
            "shot_description",
            "star",
            "rating",
            "details_description", ]

        # Какие паля нужно исключить из формы
        # exclude = []

        # Если вам нужно задать атрибуты для html формы, то сделайте это здесь.
        widgets = {
            "name": forms.Textarea(attrs={"cols": 10, "rows": 1}),
        }

    @classmethod
    def save_from_form(cls, request: WSGIRequest, true_method="POST") -> Tuple[bool, Any]:
        """
        Метод для верификации и сохранения данных, из формы, в БД. Вызывать вручную.
        """
        """
        def index(request:WSGIRequest):
            form = AddPost.create_form(request)
            context = {"form": form[1], ... }
            return render(request, template_name="Name_app/Name.html", context=context, )
        """
        if request.method == true_method:  # Проверим метод запроса с необходимым методом
            form = cls(request.POST)  # Если метод подходящий, то создаем объект формы
            if form.is_valid():  # Проверим валидность данных из формы
                form.save()  # Если данные корректны, то сохранить данные в БД
                return True, ""  # Возвращаем заглушку
            return False, form  # Если валидация не пройдена, то вернем форму с сообщениями об ошибках
        else:
            return False, cls()  # Если метод не подходящий, то вернем форму для html шаблона
```

`app/views.py` Использование в функции представлении

```python
def form_test(request: WSGIRequest):
    form = ProductForm.save_from_form(request)

    context = {
        "form": form[1]
    }
    return render(request,
                  template_name="myapp/form_test.html",
                  context=context, )
```

`app/templates/app/form_test.html` Использование в `html` шаблоне

```js
<div class="myform">
    <form method="post" name="MyForm"
          action=""
          accept-charset="UTF-8"
          autocomplete="on"
          target="_self"
          enctype="application/x-www-form-urlencoded"> {% csrf_token %}


        {% for f in form %}
            <label>
                {{ f.label }} <br>
                {{ f }}
            </label>{{ f.errors }} <br>

        {% endfor %}

        <input type="submit">
    </form>
</div>
```

# Django Admin панель

## Создать Admin пользователя

Подготовка:

1. Установить русский язык для админ панель

    `Nmae_proj/settings.py`

    ```python
    LANGUAGE_CODE = 'ru'
    ```

1. Создать профиль админа

    ```bush
    python manage.py createsuperuser
    ```

1. Зарегистрировать модель в `ИмяПриложения/admin.py`

    ```python
    from django.contrib import admin
    from .models import <ИМЯ_МОДЕЛИ_БД1>, <ИМЯ_МОДЕЛИ_БД2>

    admin.site.register(<ИМЯ_МОДЕЛИ_БД1>)
    admin.site.register(<ИМЯ_МОДЕЛИ_БД2>)
    ```

1. Войти в админ панель, по стандарту это `URL` = `http://127.0.0.1:8000/admin/`

# Авторизация

# Тестирование






