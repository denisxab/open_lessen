# Структура проекта

- `<Name_proj>`

    - `asgi.py` = Для настройки хостинга(для новых проектов)
    - `settings.py` = Глобальные настройки проекта
    - `urls.py`= **URL** маршрутизаци
    - `wsgi.py` = Для настройки хостинга(для старых проектов)

- `<Name_app>` = Стороннее Приложение

    - `migrations` = миграции БД.
        - `0001_initial.py` = Варианты мигарции БД
    - `templates` = Шаблоны для приложения
        - `<Name_app>` = Имя должно совпадать с именем приложения
            - `name.html`
    - `static` = Статические файлы для приложения
        - `<Name_app>` = Имя должно совпадать с именем приложения
            - `css`
                - `name.css`
            - `js`
                - `name.js`
            - `img`
                - `name.png`
            - `fonts` Сторонии шрифты
                - `name.ttf`
    - `templatetags` = Папка для пользовательских фильтров и тего`html`
    - `admin.py` = Связь с админ панелью сайта
    - `apps.py`= Настройки конфигурирования текущего приложения
    - `models.py `= Логика ORM моделей
    - `test.py` = Тесты
    - `views.py` = Логика представлений -`urls.py`
    - `forms.py` = Логика для форм
    - `urls.py`

- `media` = Общая папка для медео файлов.
- `templates` =Общие шаблоны проекта.
- `manage.py` = Файл нужен для управления проектом

---

# `settings.py` = Настройка для всего проекта

В `settings.py` хранятся все глобальные настройки для проекта. [Документация про settings.py](https://docs.djangoproject.com/en/3.2/ref/settings/)

---

```python
"""
Django settings for experement project.

Generated by 'django-admin startproject' using Django 3.2.8.

For more information on this file, see
https://docs.djangoproject.com/en/3.2/topics/settings/

For the full list of settings and their values,
https://docs.djangoproject.com/en/3.2/ref/settings/
"""
import os
from pathlib import Path



# Конфиденциальность ######################################################################################
import __dont_publish
__dont_publish.run() # Создаем переемные окружения
SECRET_KEY = os.getenv("DJANGO_SECRET_KEY") # Секретный ключ, который нужно держать в  тайне. Например получать из переменных окружения
############################################################################################################


# Диплой #################################################################################################
DEBUG = True # Если `True` будет отображать отладочную информацию
ALLOWED_HOSTS = [] # Список хостов который будет обслуживать Django
############################################################################################################



# Плагины ##################################################################################################
# Все инсталлированные приложения на вашем сайте.
INSTALLED_APPS = [
     'django.contrib.admin',
     'django.contrib.auth',
     'django.contrib.contenttypes',
     'django.contrib.sessions',
     'django.contrib.messages',
     'django.contrib.staticfiles',
]
"""
При создании приложений, нужно добавлять его сюда. Шаблон добавление приложения `"<name_app>.apps.<Name_app>Config",`
"""
# Список используемых плагинов.
MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]
############################################################################################################



# Шаблонизаторы #############################################################################################
"""
Список, содержащий настройки для всех шаблонизаторов, которые будут использоваться с Джанго.
Каждый элемент списка представляет собой словарь, содержащий параметры для индивидуального двигатель.
"""
TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates', # Используемый шаблонный сервер.
        'DIRS': [os.path.join(BASE_DIR, 'templates')], # Каталоги, в которых движок должен искать исходные файлы шаблонов, в поиске порядок.
        'APP_DIRS': True, # Должен ли движок искать исходные файлы шаблонов внутри установленного Приложения.
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]
############################################################################################################



# Базы данных ###############################################################################################
"""
Словарь, содержащий настройки для всех баз данных, которые будут использоваться с Джанго.
"""
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'app_name': BASE_DIR / 'db.sqlite3',
    }
}
DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField' # Автоматически добавлять поле primary_key к БД
############################################################################################################



# Валидация ################################################################################################
"""
Список валидаторов, которые используются для проверки надежности паролей пользователей.
"""
AUTH_PASSWORD_VALIDATORS = [
    {
        'app_name': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'app_name': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'app_name': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'app_name': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]
############################################################################################################



# Локализацтя ##############################################################################################
LANGUAGE_CODE = 'ru' # Язык сервера
USE_I18N = True # Логическое значение, указывающее, должна ли быть включена система перевода Django.
TIME_ZONE = 'UTC' #  Часовой пояс
USE_L10N = True # Логическое значение, указывающее, будет ли включено локализованное форматирование данны
USE_TZ = True # Логическое значение, указывающее, будут ли даты по умолчанию учитывать часовой пояс
############################################################################################################



# Пути к файлам ############################################################################################
BASE_DIR = Path(__file__).resolve().parent.parent # Полный путь к вашему проекту
ROOT_URLCONF = '<proj>.urls' # Путь к основному urls.py

## Статические файлы
STATIC_URL = '/static/' # URL-адрес для использования при обращении к статическим файлам, расположенным в STATIC_ROOT.
STATIC_ROOT = os.path.join(BASE_DIR, "static/")  # Путь к общей статической папки.
STATICFILES_DIRS = [ # Список нестандартных путей используемых для сборки.
    # os.path.join(BASE_DIR, "static"),
]
"""
Внимание **если у вас есть две папки** `static`, одна общая папка для всех,
а другая в приложение, то данные будут **браться из папки приложения**
"""

## Изображения
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')  # Имя папки в корневом каталоге, для изображений
MEDIA_URL = '/media/' # Добавляет к файлам префикс
############################################################################################################
```

# `urls.py` = Маршрутизация по сайту

## Функции для маршрутизации

Все запросы от клиентов приходят в этот файл. Наша задача перенаправить запрос в нужное "Представления" который храниться в `views.py` [Документация по urls.py](https://docs.djangoproject.com/en/3.2/ref/urls/)

```python
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
	path('admin/', admin.site.urls),
	path('<Путь>', include('<main_app>.url')),
]
```

| Функция                                       | Url                                        | Описание                                                                                            |
| --------------------------------------------- | ------------------------------------------ | --------------------------------------------------------------------------------------------------- |
| path(`'admin/', admin.site.urls`)             | `http://127.0.0.1:8000/admin`              | Обработчик URL. Пример `url` обработчика админ панели                                               |
| path(`'<Путь>', include('<main_app>.url')`)   | `http://127.0.0.1:8000/<Путь>`             | Дописывать к URL приложению указанный `<Путь>`                                                      |
| path(`'<Путь>/<int:NAME_ID>/, ...`)',         | `http://127.0.0.1:8000/<Путь>/123`         | Динамические параметры для URL запроса, `NAME_ID` будет передан в функцию представления             |
| re_path(`r'<Путь>/(?P<name>pattern)/', ... `) | `http://127.0.0.1:8000/<Путь>/<параметер>` | Используя регулярные выражения, можно создавать свои правила для динамической обработки URL запроса |

---

## Динамические парамеры у URL запроса.

```python
from django.contrib import admin
from django.http import HttpResponse
from django.urls import path, include, re_path

urlpatterns = [
    path('cats/<int:NAME_ID>/', lambda request, NAME_ID: HttpResponse(f"{request.GET}{NAME_ID}")),
    re_path(r'^archive/(?P<year>[0-9]{4})/', lambda request, year: HttpResponse(f"{request.GET}{year}")),
]
```

> В регулярных выражениях Python синтаксис именованных групп регулярных выражений является `(?P<name>pattern)`, куда `name`это название группы и `pattern`это какой-то шаблон для сопоставления. [Источник](https://djbook.ru/rel3.0/topics/http/urls.html)

Кроме использования `int` в динамических параметрах URL. Можно использовать:

| Ключевое слово | Описание                             |
| -------------- | ------------------------------------ |
| `int`          | Любое положительное число            |
| `str`          | Любая не пустая строка, исключая `/` |
| `slug`         | Символы `ASCII`,`-`,`_`              |
| `uuid`         | Цифры, нижний регистр `ASCII`,`-`    |
| `path`         | Любая не пустая строка, включая `/`  |

---

## Именованные URL адреса

Для простого редиректа и навигации, лучше задавать имена к `URL` адресам. Для этого в функции `path`/`re_path` установите имя для аргумента `name`, после этого Django будет сам устанавливать полный путь к `url` адресу.
[Документация про именованные url адреса ](https://docs.djangoproject.com/en/3.2/topics/http/urls/#reverse-resolution-of-urls)

```python
#`app.urls.py`
urlpatterns = [
    path('', index, name="home"),  		# http://127.0.0.1:8000/app/
    path('test1', test_1),  			# http://127.0.0.1:8000/app/test1
]
```

```python
#`app.urls.py`
def test_1(request):
    if True:
        return redirect('home')
    return HttpResponse(f"{str(request.GET)}test_1")
```

После этого мы можем обращаться к этим именованным `url` адресам:

| Где    | Пример                                                                        | Описание                                                                |
| ------ | ----------------------------------------------------------------------------- | ----------------------------------------------------------------------- |
| `html` | `<a href="{% url '<ИмяURL>' %}"></a>`                                         | В html шаблонах                                                         |
| `html` | `<a href="{% url '<ИмяURL>' <ПараметрURL_1> <ПараметрURL_N> %}"></a>`         | В html шаблоны можно также передавать параметры для динамического `URL` |
| `py`   | `return redirect('<ИмяURL>')`                                                 | Перенаправление на указанную страницу.                                  |
| `py`   | `return reverse("<ИмяURL>", kwargs={"<POST_ID>": <self.NAME>})` ->`__proxy__` | Сразу определить `url` адрес.                                           |
| `py`   | `return reverse_lazy('<ИмяURL>')`->`str`                                      | Динамически определять `url` адрес, в момент вызова.                    |

---

Пример `<a href="{% url '<ИмяURL>' <ПараметрURL_1> <ПараметрURL_N> %}"></a>`

`urls.py`

```python
from django.urls import path

from myapp.views import index_main

urlpatterns = [
    path('<int:name_id>/<int:name_id2>', index_main, name="home"),
]

```

`myapp/views.py`

```python
from django.core.handlers.wsgi import WSGIRequest
from django.shortcuts import render


# Create your views here.


def index_main(request: WSGIRequest, name_id, name_id2):
    context = {
        "name_id": name_id + 10,
        "name_id2": name_id2 + 10,
    }
    return render(request,
                  template_name="myapp/index_main.html",
                  context=context, )
```

`templates/myapp/index_main.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<a href="{% url 'home' name_id name_id2%}">LIN</a>

</body>
</html>
```

---

Пример `return reverse("<ИмяURL>", kwargs={"<POST_ID>": <self.NAME>})`. Если нам нужно брать `url` адрес из БД, то лучше определить для этого метод `get_absolute_url`

`myapp/model.py`

```python
from django.db import models

# Create your models here.
from django.urls import reverse


class TestDb(models.Model):
    name = models.TextField(db_column="Наименование товара")

    def __str__(self):
        """
        Для отображение в текстовом виде для админ панели, и консоли.
        """
        return str(self.pk)

    def get_absolute_url(self):
        """
        Для получения ссылки записи в Html и отображение в админ панели.
        """
        return reverse("ПримерURL", kwargs={"pk": self.pk})

    class Meta:
        """
        Вспомогательный класс для админ панели.
        """
        verbose_name = "TestDb"  # Имя таблицы в единственном числе
        verbose_name_plural = "TestDbs"  # Имя таблицы во множественном числе
        ordering = ["pk", ]  # Сортировать записи по указан ным столбцам (можно указывать несколько столбцов)
```

`myapp/views.py`

```python
from django.core.handlers.wsgi import WSGIRequest
from django.http import HttpResponse
from django.shortcuts import render

# Create your views here.
from myapp.models import TestDb


def home_fun(request: WSGIRequest, pk):
    return HttpResponse(f"{request.GET}{pk}")


def index_main(request: WSGIRequest):
    post = TestDb.objects.first()
    context = {
        "post": post,
    }
    return render(request,
                  template_name="myapp/index_main.html",
                  context=context, )

```

`myapp/urls.py`

```python
from django.urls import path

from myapp.views import index_main, home_fun

urlpatterns = [
    path('', index_main, name="home"),
    path('home/<int:pk>', home_fun, name="ПримерURL"),
]

```

`templates/myapp/index_main.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<a href="{{ post.get_absolute_url }}">LIN</a>

</body>
</html>
```

## Обработка `Http` ошибок

Можно переопределять логику программы при возникновении `http` ошибок. [Список ошибок](http://allerrorcodes.ru/http-2/)

| Ошибка     | Описание                                                 |
| ---------- | -------------------------------------------------------- |
| handler400 | Некорректный запрос                                      |
| handler403 | Доступ к странице запрещен. (клиент не аутентифицирован) |
| handler404 | Страница не найдена                                      |
| handler500 | Ошибка сервера                                           |

---

Пример переопределения ошибки. Обратите внимание, что обрабатывать исключения `http` лучше в `proj/urls.py`. Так ошибки могут возникать в разных `url` приложениях, и поэтому они могут не обработать их.

`proj/urls.py`

```python
from django.http import HttpResponseNotFound

urlpatterns = [ .. ]

handler404 = lambda request, exception: HttpResponse(f"Станица не найдена {exception}", status=404)
```

# `views.py`= Логика web-приложения

В файле `views.py` приходят запросы или ответы от `urls.py`, в этом файле нам нужно обработать эти данные, и передать их в шаблон `html`.

---

## Функции представления

**Функции представления** = Это простой способ настроить логику обработки `url` запроса. Функция представления всегда принимает первым аргументом`request`. [Документация про функции представления](https://docs.djangoproject.com/en/3.2/topics/http/shortcuts/).

---

| Функции                                                                      | Описание                                                                                                    |
| ---------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| return HttpResponse(`content="<HtmlТекст>", status=200`)                     | Вернуть html текст                                                                                          |
| return render(`<request>, "<Путь_к_html_файлу>", contect=<Данные_в_шаблон>`) | Вернуть шаблонный файл `html`. Помните о том что сначала нужно указать имя приложения. Пример: `app/t.html` |
| return redirect(`<"ИменованыйUrl">`)                                         | Перенаправить на указанный именованный `URL`адрес. Код `302` - Временно перемещена                          |
| return redirect(`<"ИменованыйUrl">, permanent=True`)                         | Перенаправить на указанный именованный `URL`адрес. Код `301` - Постоянное перемещение                       |

---

Стандартный шаблон.

```python
def index_main(request: WSGIRequest):

    context = {} # Укзать какие данные нужно отправить в шаблон `html`

    return render(request,
                  template_name="ИмяПриложения/Имяфайла.html",
                  context=context, )
```

## Классы представления

**Классы представления** = Классы представления это удобный механизм для создания логики обработке `http` запросов. К тому же, существует много готовых классов представления, которые помогают решать стандартные задачи.

---

Особенности Классов представления:

- В `urls.py` в функции `path`, нужно вызвать метод класса `$ИмяКлассаПредставления$.as_view()`
- Класс представления сам вызывает одноименные методы класса с `http` методами.

Полезные ссылки:

- [Введение в представления на основе классов](https://docs.djangoproject.com/en/3.2/topics/class-based-views/intro/)
- [Атрибуты и методы в классах представления](https://djbook.ru/rel1.9/ref/class-based-views/flattened-index.html)
- [Список всех классов представления](https://docs.djangoproject.com/en/3.2/ref/class-based-views/)
- [Видео урок про классы представления](https://www.youtube.com/watch?v=_0IDdU6PDJo)

---

| Класс представления | Описание                                                                            | Краткое имя для шаблона |
| ------------------- | ----------------------------------------------------------------------------------- | ----------------------- |
| `View`              | Базовый класс для всех классов представления                                        | `vview`                 |
| `DetailView`        | Подробные данные о записи из БД. Принимает динамический `url` записи                | `vdetail`               |
| `ListView`          | Класс для страницы с записями(ленты). Быстро можно настроить пагинацию по страницам | `vlist`                 |
| `CreateView`        | Класс для создания записей в БД. Использует `forms.ModelForm`                       | `vcreate`               |

---

`View` = Базовый класс для всех классов представления. В нем уже есть перенаправление в одноименные методы класса с `http` методами.

```python
class $NameClass$(View):

    template_name = "$app$/$name_file$.html" # Путь к шаблону `html`
    http_method_names = ["get", "post",] # Список методов HTTP, которые обрабатывает класс.

    # model = $NameModel$ # Какую модель используем
    # queryset = $NameModel$.objects.$MethodModel$ # Получаем данные из БД


    def get(self, request: WSGIRequest):
        """
        В методе обрабатывается GET запрос
        request.method == "GET"
        """
        return render(request,
                      template_name=self.template_name,
                      context=self.get_context_data(), )

    def post(self, request: WSGIRequest, *args, **kwargs):
        """
        В методе обрабатывается POST запрос
        request.method == "POST"
        """
        ...

    def get_context_data(self, **kwargs) -> dict[str, Any]:
        """
        Сформировать контекст для шаблона `html`
        """
        context = {
            $END$
        }
        return context
```

---

`DetailView` = Подробные данные об одной записи из БД.

- В `urls.py` у функции `path` должен быть динамический `url` - либо `<int:pk>/`либо `<int:slug>/` которые ищется в БД.
- Чтобы изменить имя динамического `url`, переопределить значения атрибутов `slug_url_kwarg` для `slug`. `pk_url_kwarg` для `pk`.

```python
class $NameClass$DetailView(DetailView):
    model = $NameModel$ # Какую модель используем
    queryset = $NameModel$.objects.$MethodModel$ # Получаем данные из БД
    template_name = "$app$/$name_file$.html" # Путь к шаблону `html`
    http_method_names = ["get", "post",] # Список методов HTTP, которые обрабатывает класс.
    context_object_name = "$NameClass$" # Для результата класса, Даем понятное имя переменой в шаблон.

    def get(self, request: WSGIRequest, *args, **kwargs):
        """
        В методе обрабатывается GET запрос

        request.method == "GET"
        print(request.GET)
        """

        resget = super().get(request, *args, **kwargs)
        return resget

    def post(self, request: WSGIRequest, *args, **kwargs):
        """
        В методе обрабатывается POST запрос

        request.method == "POST"
        """

        print(request.POST)

    def get_context_data(self, **kwargs) -> dict[str, Any]:
        """
        В этом методе формировать `context` для шаблон `html`
        :return: context
        """
        context = super().get_context_data(**kwargs)
        return context
```

---

`ListView` = Класс для страницы с записями. Лего можно настроить пагинацию.

- `allow_empty` = Логическое значение, указывающее, следует ли отображать страницу, если объекты отсутствуют. Если это `False`и нет записи, то вызовет `404` ошибку.
- `page`стандартное имя странице. Если нужно, то это имя можно переопределить в `page_kwarg`.

```python
class $NameClass$ListView(ListView):
    model = $NameModel$ # Какую модель используем
    queryset = $NameModel$.objects.$MethodModel$ # Получаем данные из БД
    template_name = "$app$/$name_file$.html" # Путь к шаблону `html`
    http_method_names = ["get", "post",] # Список методов HTTP, которые обрабатывает класс.
    context_object_name = "$NameClass$" # Для результата класса, Даем понятное имя переменой в шаблон.
    allow_empty = False  # Отображать ошибку 404 если страница не найдена

	paginate_by = $CountPost$ # Целое число, указывающее, сколько объектов должно отображаться на странице.
	ordering = "$SortColumn$" # Сортировать записи по столбцу


    def get(self, request: WSGIRequest, *args, **kwargs):
        """
        В методе обрабатывается GET запрос

        request.method == "GET"
        print(request.GET)
        """

        resget = super().get(request, *args, **kwargs)
        return resget

    def post(self, request: WSGIRequest, *args, **kwargs):
        """
        В методе обрабатывается POST запрос

        request.method == "POST"
        """

        print(request.POST)

    def get_context_data(self, **kwargs) -> dict[str, Any]:
        """
        В этом методе формировать `context` для шаблон `html`
        :return: context
        """
        context = super().get_context_data(**kwargs)
        # СВОЯ переменная, которую можно использовать для ограничения предложенных страниц
        context["max_offer_page"] = (-2,2)
        return context
```

---

`CreateView` = Класс для создания записей в БД. Использует Модель-Форму.

- `success_url` = URL-адрес для перенаправления после успешной обработки формы.

```python
class $NameClass$CreateView(CreateView):
    form_class = $ProductForm$ # Модель-формы
    template_name = "$app$/$name_file$.html" # Путь к шаблону `html`
    http_method_names = ["get", "post",] # Список методов HTTP, которые обрабатывает класс.
    success_url = reverse_lazy("$NameUrlRederect$")  # URL-адрес для перенаправления после успешной обработки формы.

    # model = $NameModel$ # Какую модель используем, по умолчанию берёт модель из `form_class`
    # context_object_name = "$NameClass$" # Для результата класса, Даем понятное имя переменой в шаблон.

    def get(self, request: WSGIRequest, *args, **kwargs):
        """
        В методе обрабатывается GET запрос

        request.method == "GET"
        """
        resget = super().get(request, *args, **kwargs)
        return resget

    def post(self, request: WSGIRequest, *args, **kwargs):
        """
        В методе обрабатывается POST запрос

        request.method == "POST"
        """
        # Проверить данные, если они корректные то сохранить их в БД
        respost = super().post(request, *args, **kwargs)
        return respost

    def get_context_data(self, **kwargs) -> dict[str, Any]:
        """
        В этом методе формировать `context` для шаблона `html`

        :return: context
        """
        context = super().get_context_data(**kwargs)
        return context
```

## Пагинация `ListView`

`page_obj` [Про Page](https://docs.djangoproject.com/en/3.2/ref/paginator/#page-class)

| Метод, Атрибут                | Описание                                                                                                  |
| ----------------------------- | --------------------------------------------------------------------------------------------------------- |
| `page`.number                 | Номер для этой страницы, отсчитываемый от 1.                                                              |
| `page`.has_next()             | Возврат `True`если есть следующая страница.                                                               |
| `page`.has_previous()         | Возврат `True`если есть предыдущая страница.                                                              |
| `page`.has_other_pages()      | Возврат `True`если есть следующая **или** предыдущая страница.                                            |
| `page`.next_page_number()     | Возвращает номер следующей страницы. Поднимает `InvalidPageесли` если следующая страница не существует.   |
| `page`.previous_page_number() | Возвращает номер предыдущей страницы. Поднимает `InvalidPageесли` если предыдущей страницы не существует. |
| `page`.paginator.count        | Общее количество всех элементов на всех страницах                                                         |
| `page`.paginator.num_pages    | Общее количество страниц.                                                                                 |
| `page`.paginator.page_range   | Итератор для страниц                                                                                      |

Шаблон для пагинации.

> ![Шаблон для пагинации.](_attachments/Pasted%20image%2020211030203136.png)

```html
<!--

offer-page = Стиль для числа со страницей
select-offer-page = Стиль для выделенного числа со страницей

//-->


{# Если есть хотябы больше одной страницы#}
{% if page_obj.has_other_pages %}

    {# Добавить кнопки перемещения страниц назад#}
    {% if page_obj.has_previous %}
        {# Первая страница #}
        <a href="?page=1">
            <div class="offer-page">
                1
            </div>
        </a>
        <a href="?page={{ page_obj.previous_page_number }}">
            <div class="offer-page">
                &lt;
            </div>
        </a>
    {% endif %}

    {% for p in page_obj.paginator.page_range %}
        {# Выделеть выбранную страницу #}
        {% if page_obj.number == p %}
            <div class="offer-page select-offer-page">
                {{ p }}
            </div>
            {# Не отображать страницы более N страниц #}
        {% elif p >= page_obj.number|add:max_offer_page.0  and p <= page_obj.number|add:max_offer_page.1 %}

            <a href="?page={{ p }} ">
                <div class="offer-page">
                    {{ p }}
                </div>
            </a>
        {% endif %}
    {% endfor %}

    {# Добавить кнопки перемещения страниц вперед#}
    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}">
            <div class="offer-page">
                &gt;
            </div>
        </a>

        {# Последняя страница #}
        <a href="?page={{ page_obj.paginator.num_pages }}">
            <div class="offer-page">
                {{ page_obj.paginator.num_pages }}
            </div>
        </a>
    {% endif %}
{% endif %}

```

```css
/*Пагинатор*/
.pagination {
    text-align: center;
    margin: auto;
    width: 50%;
    font-size: 22px;
}

.offer-page {
    padding: 10px;
    border: 3px solid var(--ThreeBg);
    background: var(--TwoBg);
    width: 60px;
    height: 60px;

}

.offer-page:hover {
    background: var(--OneBg);
    color: var(--OneColorText);
}

.select-offer-page {
    background: var(--OneBg);
}
/*END Пагинатор*/
```

```python
class MainProductRibbon(ListView):
    """
    Главная лента товаров
    """

    model = Product  # Какую модель используем
    queryset = Product.objects.all()  # Получаем данные из БД
    template_name = "myapp/MainProductRibbon.html"  # Путь к шаблону `html`
    http_method_names = ["get", "post", ]  # Список методов HTTP, которые обрабатывает класс.
    context_object_name = "MyPaginator"  # Для результата класса, Даем понятное имя переменой в шаблон.
    allow_empty = False  # Отображать ошибку 404 если страница не найдена

    paginate_by = 3  # Целое число, указывающее, сколько объектов должно отображаться на странице.
    ordering = "star"  # Сортировать записи по столбцу

    def get(self, request: WSGIRequest, *args, **kwargs):
        """
        В методе обрабатывается GET запрос

        request.method == "GfET"
        """
        resget = super().get(request, *args, **kwargs)
        return resget

    def post(self, request: WSGIRequest):
        """
        В методе обрабатывается POST запрос

        request.method == "POST"
        """
        ...

    def get_context_data(self, **kwargs) -> dict[str, Any]:
        """
        В этом методе формировать `context` для шаблона `html`

        :return: context
        """
        context = super().get_context_data(**kwargs)
        # СВОЯ переменная, которую можно использовать для ограничения предложенных страниц
        context["max_offer_page"] = (-2, 2)
        return context
```

# `app/templates/app/file.html` = Html шаблоны

Все `html` документы для вашего приложения принято хранить в папке `ИмяПриложения/templates/ИмяПриложения`

Краткий обзор

| Внешний вид           | Название                                                                                               |
| --------------------- | ------------------------------------------------------------------------------------------------------ |
| `{% ИмяТега %}`       | Обращение к тегу. [Все встроенные теги](https://docs.djangoproject.com/en/3.2/ref/templates/builtins/) |
| `{{ ИмяПеременной }}` | Обращение к переменной. Нельзя давать имена переменым начинающеюся с нижнего подчеркивания `_`.        |
| `{% ИмяТега as Имя%}` | Сохранить результат тега в переменную                                                                  |

---

Все переменные переданные в шаблон `html` будут конвертированные в `str`. То есть при передаче в `html` шаблон `Django` будут вызвать метод класса `__str__()`. Пример:

```python
class Test:
    def __init__(self):
        self.name = (1, 2, 3)

    def __str__(self):
        return "Вызван метод __str__"
```

---

Для удобства вы можете выбрать подцветку синтаксиса шаблонизатора. Если у вас полная версия, то вам будет доступен `Django`

![шаблон django](_attachments/da9011f81fbcc329514e858ffb8631f6.png)

---

## Теги шаблонизатора

### `for`/`empty`/`cycle`/`if`/`elif`/`else`

---

Тег `for` работает как обычный цикл, он перебирает переданный итерируемый объект.

Пример одномерного массива

```html
{% for x in ИмяИтератора  %}
{{ x }}
{% endfor %}
```

Пример двумерного массива. **Нужно обращаться к индексу через точку `.`**

```html
{% for x in ИмяИтератора  %}
{{ x.0 }}{{ x.1 }}{{ x.2 }} <br>
{% endfor %}
```

Пример словаря. В шаблоне можно использовать такие же методы как и в `Python`, только их **не** нужно вызвать `()`

```html
{% for k,v in ИмяИтератора.items %}
    {{ k }}:{{ v }} <br>
{% endfor %}
```

Аналог `enumerate` это `{{ forloop.counter0 }}` [+](https://docs.djangoproject.com/en/3.2/ref/templates/builtins/#for)

```html
{% for x in ИмяИтератора  %}
	{{ forloop.counter0 }} {{ x }}<br>
{% endfor %}
```

Создать итератор из строки это `|make_listp`

```html
{% for star in "1234567"|make_list %}
	{{ star }}
{% endfor %}
```

Если нужно повторить несколько раз одно и то же действие, это `|rjust:`

```bush
{% for star in "x"|rjust:"<Число>" %}
	{{ star }}
{% endfor %}
```

---

Тег `empty`. Это тег срабатывает если массив пустой.

```python
{% for v in ИмяИтератора.values %}
    {{ v }}
{% empty %}
    Извините но массив пустой
{% endfor %}

{#===#}

{% if ИмяИтератора %}
    {% for athlete in ИмяИтератора %}
        {{ v }}
    {% endfor %}
{% else %}
    Извините но массив пустой
{% endif %}
```

---

Тег `cycle`. Бывает встречаться задачи когда нужно циклично дублировать стили для `html`. Для это есть шаблонный тег `cycle`

```html
{% for v in ИмяИтератора %}
    <span style="font-size:{% cycle 10 20 30 40 %}">
        {{ v }}
    </span>
{% endfor %}
```

- ![cycle](_attachments/432035a9ea5950676ca7035bf9b513fc.png)

---

Тег `if`/`elif`/`else` работает как обычный `if`/`elif`/`else`. Пример:

```html
{% if v > 2 %}
	...
{% elif v == 1 %}
	...
{% else %}
	...
{% endif %}
```

Также можно указать несколько условия.

```python
{% if v > 2 and v < 4 or not v == 0 %}
	{{ v }}
{% endif %}
```

### `block` / `extends` / `include`

`block` нужен для уменьшения дублирования когда, он это делает путем расширения готовых `html` шаблонов.
Правописание `block`. Принято закрывать блок с тем же именем, с каким он создан.

```html
{% block NameBlock %}


{% endblock NameBlock %}
```

---

`extends` Нужен как раз для расширения шаблона. Блоки с одинаковыми именами будут наследоваться. Обратите внимание при `extends` в базовый шаблон добавляется только `block`, любой другой контент просто игнорируется и в базовый шаблон не добавляется. [Наследование шаблонов](https://docs.djangoproject.com/en/3.2/ref/templates/language/#template-inheritance)

```html
{% extends "ИмяПриложения/ИмяБазовогоШаблона.html" %}
```

Добавить контент из базового блока, в блок наследника, можно путем вызова функции. `{{ block.super }}`.

```bush
{% block NameBlock %}

{{ block.super }}

{% endblock NameBlock %}
```

---

`include` = Нужен для простой вставки содержания `html` файла. Правописание `include`:

```html
{% include  "ИмяПриложения/ИмяДругогоаШаблона.html"%}
```

---

Давайте разбираем пример наследование шаблонов.

`urls.py`

```python
from django.urls import path

from myapp.views import index_main, home_fun

urlpatterns = [
    path('', index_main, name="index"),
    path('home/', home_fun, name="home"),
]
```

`views.py`

```python
from django.core.handlers.wsgi import WSGIRequest
from django.shortcuts import render


def home_fun(request: WSGIRequest):
    context = {
    }
    return render(request,
                  template_name="myapp/chaild.html",
                  context=context, )


def index_main(request: WSGIRequest):
    context = {
    }
    return render(request,
                  template_name="myapp/index_main.html",
                  context=context, )
```

`index_main.html`

```html


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>Привет авантюрист</h1>

<a href="{% url 'index' %}">Index</a><br>
<a href="{% url 'home' %}">Home</a><br>

{% block NameBlock %}
    <h4>Главный текст</h4>
{% endblock NameBlock %}

</body>
</html>
```

`chaild.html`. Обратите внимание, что негде нет`Любой текст из chaild.html`

```html
{% extends "myapp/index_main.html" %}
Любой текст из chaild.html
{% block NameBlock %}
     {{ block.super }}
    <h4>Текст блока</h4>
    {% include  "myapp/new_content.html"%}
{% endblock NameBlock %}
```

> А вот пример того что `Любой текст из chaild.html` появился в `chaild.html`.
>
> ```python
> {#{% extends "myapp/index_main.html" %}#}
> Любой текст из chaild.html
> {% block NameBlock %}
> {#     {{ block.super }}#}
>
>     <h4>Текст блока</h4>
> {% endblock NameBlock %}
> ```

## Стандартыне фильтры для переменных

В `html` шаблонах мы можем применять некоторые готовые фильтры, или точнее "действия", для переемных. [Список встроенных фильтров](https://djbook.ru/rel3.0/ref/templates/builtins.html#built-in-filter-reference)

| Фильтр                               | Описание                                                                                                   |
| ------------------------------------ | ---------------------------------------------------------------------------------------------------------- |
| `{{ value │ default:"nothing" }}`    | Установить значение по умолчанию                                                                           |
| `{{ value │ dictsort:"name" }}`      | Сортировка словаря                                                                                         |
| `{{ value │ first }}`                | Возвращает первый элемент списка                                                                           |
| `{{ value │ last }}`                 | Возвращает последний элемент списка                                                                        |
| `{{ value │ linenumbers }}`          | Отображает текст как нумерованный                                                                          |
| `{{ value │ ljust:"10" }}`           | Выравнивает значение влево в поле указанной ширины.                                                        |
| `{{ value │ random }}`               | Возвращает случайный элемент из списка                                                                     |
| `{{ some_list │ slice:":2" }}`       | Сделать слайс списка                                                                                       |
| `{{ value │ truncatewords:2 }}`      | Обрезать сроку до длины                                                                                    |
| `{{ var │ unordered_list }}`         | Создает элемент таблицы HTML (li) [+](https://djbook.ru/rel3.0/ref/templates/builtins.html#unordered-list) |
| `{{ value │ urlize }}`               | Делает из текста ссылку                                                                                    |
| `{{ value │ urlizetrunc:15 }}`       | Делает из текста ссылку, обрезает результат до указанной длинно                                            |
| `{{ value │ wordcount }}`            | Возвращает количество слов                                                                                 |
| `{ value │ yesno:"yeah,no,maybe" }}` | Преобразует булевые значение в понятные сообщения                                                          |
| `{{ value │ linebreaks }}`           | Ставит переносы строки в конец текста                                                                      |

## Создание своих шаблоны в`html`

В `Django` бывает не хватает встроенных тегов, но у нас есть возможность создавать собственные теги. [Про собственные шаблоны и теги](https://djbook.ru/rel3.0/howto/custom-template-tags.html)

1. Создать пакет `templatetags`, и уже в нем создавать файлы с вашими тегами.
    - `ВашеПриложение`/
        - `__init__.py`
        - `models.py`
        - `templatetags/` (Обязательное имя)
            - `__init__.py` (+)
            - `ВашиТеги.py` (+)
                ```python
                from django import template
                register = template.Library()
                ```
        - `views.py`
1. Загрузить наш шаблон в `html` документ
    ```html
    {% load ВашиТеги %}
    ```

---

| Декоратор          | Описание                                      | Вид          |                    |
| ------------------ | --------------------------------------------- | ------------ | ------------------ | --- |
| `@register.filter` | Зарегестрировать фильтер                      | `{{ quantity | multiply:price }}` |     |
| `@stringfilter`    | Конвертировать входные данные функции в `str` |              |                    |

### Простой тег - функция

Простой тег - принимает данные как функция, и возвращает результат, в место своего вызова.

```python
@register.simple_tag()
def tagSum(a,b,c):
	"""
	{% tagSum 1 2 3 %}
	"""
	return a+b+c
```

### Включающий тег - генерирует `html` фрагмент

Включающий тег - должен возвращать `context:dict` для `html` документа, который в свою очередь вставиться в место вызова "включающего тега". Таким обозом он генерирует `html` фрагмент.

```python
@register.inclusion_tag("myapp/testTag.html")
def tagInclusion(data1,data2):
	"""
	{% tagInclusion data1=1 data2=2 %} # По имени

	{% tagInclusion 1 2 %} # По позиции
	"""
	return {"data": [data1,data2]}
```

### Фильтры

Фильтр - ведет себя как функция, но он всегда принимает минимум 2 аргумента

```python
@register.filter
def multiply(value, arg):
	"""
	{{ quantity | multiply:price }}` = `multiply(quantity,price)
	"""
	return value * arg
```

### Полезные сторонии шаблоны:

- Умножение - `{{ quantity | multiply:price }}`
    ```python
    @register.filter
    def multiply(value, arg):
    	return value * arg
    ```

## Подключение различных файлов к `Html` документу

### Подключение статических файлов `css`/`js`/`img`

- Для подключения статических файлов убедитесь что у вас есть `proj/settings.py->STATIC_URL = '/static/'`
- Для сборки всех статических файлов убедитесь что у вас есть `proj/settings.py->STATIC_ROOT` и выполните команду `python manage.py collectstatic`
- Внимание **если у вас есть две папки** `static`, одна общая папка для всех, а другая в приложение, то данные будут **браться из папки приложения**
- Помните о том что браузеры кешируют статические файлы, поэтому для обновленных данных нужно **перезагружать страницу с отчисткой кеша**. Например, у вас это возможно клавиша `Crtl+F5`.
- Помните о том что статические файлы при `DEBUG=False` должны обрабатываться веб сервером, например `nginx`. Но мы можем для теста запустить проект через команду `python manage.py runserver --insecure` и все будет работать, но такой вариант не эффективен для релиза. [Подробнее](https://stackoverflow.com/questions/5836674/why-does-debug-false-setting-make-my-django-static-files-access-fail).

    ```python
    # После `python manage.py collectstatic` закоментируйте `STATIC_ROOT` и раскоментируем `STATICFILES_DIRS`
    STATIC_URL = '/static/'
    # STATIC_ROOT = os.path.join(BASE_DIR, "static")
    STATICFILES_DIRS = [
    	os.path.join(BASE_DIR, "static"),
    ]
    ```

- Для работы со статическими фалами, нам нужно в самом вверх подключить тег `static`.

    ```html
    {% load static %}
    ```

- Принято подключать все статические файлы между тегами `<head></head>`

---

Подключить `css`

```html
<link href="{% static '$ИмяПриложения$/css/$ИмяФайла$.css' %}" rel="stylesheet" type="text/css">
```

---

Подключить `img`. Картинка может быть любым доступным форматом изображения, например`jpeg`/`png`/`svg`

```html
<img src="{% static '$ИмяПриложения$/img/$ИмяФайла$.png' %}">
```

---

Подключить `js`.

```html
<script src="{% static '$ИмяПриложения$/js/$ИмяФайла$.js' %}" type="text/javascript"></script>
```

---

### Подключить стороннее шрифты

Особенности:

- Не получиться использовать теги шаблонизатора в `css` файлов. Поэтому мы не можем использовать тег `{% static %}`, нам придется писать путь самим.
- Мы можем подключать множество сторонних шрифтов в одном `css` файле.

---

Например, давайте подключим шрифты [МойОфис](https://myoffice.ru/products/fonts/).

1. Для этого нам нужно скачать архив, и достать файл с расширением `.ttf`.
2. Создать папку `ИмяПриложения/static/fonts` и поместить туда шрифты.
3. В файле `.css` нужно добавить правило. `font-family` имя по которому можно получить шрифт во всем `css` файле, `src` путь к шрифту. [Источник](https://developer.mozilla.org/ru/docs/Web/CSS/@font-face)
    ```css
    @font-face {
    	font-family: 'XO_Courser_Nu';
        src: url('../fonts/XO_Oriel_CN_Nu.ttf') ;
    }
    ```

Пример структуры.

- `ИмяПриложения`
    - `static`
        - `css`
            - `main.css`
        - `fonts`
            - `XO_Oriel_CN_Nu.tff`
            - `XO_Courser_Nu.tff`

`main.css`

```css
.test {
    font-family: 'XO_Oriel_CN_Nu';

}

.test2 {
    font-family: 'XO_Courser_Nu';
}

@font-face {
    font-family: 'XO_Oriel_CN_Nu';
    src: url('../fonts/XO_Oriel_CN_Nu.ttf') ;
}

@font-face {
    font-family: 'XO_Courser_Nu';
    src: url('../fonts/XO_Courser_Nu.ttf') ;
}
```

### Подключаем `Bootstrap`

`Bootstrap` — свободный набор инструментов для создания сайтов и веб-приложений. Включает в себя HTML- и CSS-шаблоны оформления для типографики, веб-форм, кнопок, меток, блоков навигации и прочих компонентов веб-интерфейса, включая JavaScript-расширения. **Лицензия `MIT`**

---

Для простого и быстрого подключения `Bootstrap` скопируйте и вставьте ссылку `<link>`в ваш `<head>`, это ссылка должна быть выше других `css` файлов. [Источник с разными версиями Bootstrap](https://www.bootstrapcdn.com/)

```html
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
```

---

Полезные ссылки:

- [Примеры стилей к элементам](https://bootstrap-4.ru/docs/4.0/components/progress/)

### Подключить `jQuery`

`jQuery` - Библиотека для `JavaScript`

AJAX или асинхронный JavaScript и XML — это набор методов веб-разработки, использующих веб-технологии на стороне клиента для создания асинхронных веб-запросов.

Проще говоря, AJAX позволяет обновлять веб-страницы асинхронно, негласно обмениваясь данными с веб-сервером. Это означает, что обновление частей веб-страницы возможно без перезагрузки всей страницы.

Мы можем делать запросы AJAX из шаблонов Django, используя JQuery. AJAX методы библиотеки jQuery позволяют нам запрашивать текст, HTML, XML или JSON с удаленного сервера, используя как HTTP Get, так и HTTP Post. Полученные данные могут быть загружены непосредственно в выбранные HTML-элементы вашей веб-страницы.

---

Устанвока:

1. Переходим на официальный [сайт jquery](https://jquery.com/download/).
2. Скачиваем [Download the compressed, production jQuery 3.6.0](https://code.jquery.com/jquery-3.6.0.min.js).
3. Переносим это файл в наши статические файлы. Например `app/static/js/jquery-3.6.0.min.js`.
4. Подключаем в `html` файл.

    ```html
    <script src="{% static '$ИмяПриложения$/js/jquery-X.X.X.js'  %} " type="text/javascript"> </script>
    ```

---

## Работа с формами, не связанная с БД

### Стандартный тег `form`

- Все данные которые отправляются от клиента к серверу должны обрабатываться в `form` [Источник про form](http://htmlbook.ru/html/form).
- `Django` для нашей безопасности обязует чтобы форма имела `{% csrf_token %}`, это нужно для защиты от "Межсайтовая подделка запроса" - это значит что данные из одной формы не могут скрытно отправиться в другую форму, это достигается путем выдачи уникальных `token` для каждой формы.
- Ответ из формы `<form method="post">` будет храниться в `request.POST:dict`. При этом `request.method == "POST"`
- Ответ из формы `<form method="get">` будет храниться в `request.GET:dict`. При этом `request.method == "GET"`

| Атрибуты Form  | Описание                                                                                                                                   |
| -------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
| method         | Метод протокола HTTP. `get`/`post`                                                                                                         |
| name           | Определяет уникальное имя формы. Как правило, имя формы используется для доступа к ее элементам через скрипты.                             |
| action         | `URL` адрес в который отправиться результат из формы.                                                                                      |
| accept-charset | Кодировка символов `Windows-1251`, `UTF-8` и другие.                                                                                       |
| autocomplete   | Включает автозаполнение полей формы `on`/`off`                                                                                             |
| enctype        | Способ кодирования(не шифрования) данных формы. Передавать данные как текст или как биты [Подробнее](http://htmlbook.ru/html/form/enctype) |
| novalidate     | Если указать то отменяет встроенную верификацию данных формы.                                                                              |
| target         | Имя окна или фрейма, куда обработчик будет загружать возвращаемый результат. `_blank` в новом окне/`_self` в текущем окне/`_parent`/`_top` |

```html
<form method="post" name="MyForm"
      action=""
      accept-charset="UTF-8"
      autocomplete="on"
      target="_self"
      enctype="application/x-www-form-urlencoded"> {% csrf_token %}


</form>
```

---

#### `input`/`select`/`button`/`textarea`

**input**

[Про input](http://htmlbook.ru/html/input)

| Атрибуты input | Описание                                                                                                                                                       |
| -------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| accept         | Устанавливает фильтр на типы файлов, которые вы можете отправить через поле загрузки файлов. `<input type="file">`                                             |
| accesskey      | Переход к элементу с помощью комбинации клавиш.                                                                                                                |
| align          |                                                                                                                                                                |
| alt            | Альтернативный текст для кнопки с изображением                                                                                                                 |
| autocomplete   | Включает автозаполнение полей формы `on`/`off`                                                                                                                 |
| autofocus      | Автоматически устанавливает фокус в поле формы. В таком поле можно сразу набирать текст без явного щелчка по нему курсором мыши.                               |
| border         |                                                                                                                                                                |
| checked        | Предварительно активированный переключатель или флажок для `type="radio"`/ `type="checkbox"`                                                                   |
| disabled       | Блокирует доступ и изменение поля формы.                                                                                                                       |
| form           |                                                                                                                                                                |
| formaction     |                                                                                                                                                                |
| formenctype    |                                                                                                                                                                |
| formmethod     |                                                                                                                                                                |
| formnovalidate |                                                                                                                                                                |
| formtarget     |                                                                                                                                                                |
| list           | Указывает на список вариантов, созданный с помощью тега `<datalist>`, которые можно выбирать при наборе текста. [Про list](http://htmlbook.ru/html/input/list) |
| max            | Устанавливает верхнее значение для ввода числа или даты в поле формы. `type="number"`/`type="range"`/`type="date"`                                             |
| maxlength      | Устанавливает максимальное число символов для поля `type="text"`/`type="password"`                                                                             |
| min            | Нижнее значение для ввода числа или даты. `type="number"`/`type="range"`/`type="date"`                                                                         |
| multiple       | Позволяет загрузить несколько файлов одновременно. `type="file"`/ `type="email"`                                                                               |
| name           | Имя поля, предназначено для того, чтобы обработчик формы мог его идентифицировать.                                                                             |
| pattern        | Указывает регулярное выражение, согласно которому требуется вводить и проверять данные в поле формы. Данные не отправятся пока форма не корректна              |
| placeholder    | Выводит подсказывающий текст.                                                                                                                                  |
| readonly       | Устанавливает, что поле не может изменяться пользователем.                                                                                                     |
| required       | Обязательное поле для заполнения.                                                                                                                              |
| size           | Сколько символом можно вместить в текстовое поле. `type="text"`/`type="password"`                                                                              |
| src            | Адрес графического файла для поля с изображением. `type="image"`                                                                                               |
| step           |                                                                                                                                                                |
| tabindex       | Определяет порядок перехода между элементами с помощью клавиши Tab.                                                                                            |
| value          | Значение элемента.                                                                                                                                             |
| type           | Сообщает браузеру, к какому типу относится элемент формы.                                                                                                      |

| `<input type="...">` | Описание                                                                                                                                                       |                                                                                                                                         |
| -------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------- |
| button               | Кнопка.                                                                                                                                                        | <input type="submit" value="Кнопка">                                                                                                    |
| checkbox             | Флажки. Позволяют выбрать более одного варианта из предложенных.                                                                                               | <input type="checkbox" > Вариант1 <input type="checkbox" > Вариант2 <input type="checkbox" >Вариант3                                    |
| file                 | Поле для ввода имени файла, который пересылается на сервер.                                                                                                    | <input type="file">                                                                                                                     |
| hidden               | Скрытое поле. Оно никак не отображается на веб-странице.                                                                                                       | <input type="hidden">                                                                                                                   |
| image                | Поле с изображением. При нажатии на рисунок данные формы отправляются на сервер.                                                                               | <input type="image" src="https://clck.ru/YUarz" width="64"  height="64" alt="Фото">                                                     |
| password             | Обычное текстовое поле, но отличается от него тем, что все символы показываются звездочками. Предназначено для того, чтобы никто не подглядел вводимый пароль. | <input type="password">                                                                                                                 |
| radio                | Переключатели. Используются, когда следует выбрать один вариант из нескольких предложенных.                                                                    | <input type="radio" name="nradio" val> Вариант1 <input type="radio" name="nradio"> Вариант2 <input type="radio"  name="nradio">Вариант3 |
| reset                | Кнопка для возвращения данных формы в первоначальное значение.                                                                                                 | <input type="reset">                                                                                                                    |
| submit               | Кнопка для отправки данных формы на сервер.                                                                                                                    | <input type="submit" >                                                                                                                  |
| text                 | Текстовое поле. Предназначено для ввода символов с помощью клавиатуры.                                                                                         | <input type="text">                                                                                                                     |
| color                | Виджет для выбора цвета.                                                                                                                                       | <input type="color" value="#ff0000">                                                                                                    |
| date                 | Поле для выбора календарной даты.                                                                                                                              | <input type="date">                                                                                                                     |
| datetime             | -local Указание местной даты и времени.                                                                                                                        | <input type="datetime-local">                                                                                                           |
| email                | Для адресов электронной почты.                                                                                                                                 | <input type="email">                                                                                                                    |
| number               | Ввод чисел.                                                                                                                                                    | <input type="number">                                                                                                                   |
| range                | Ползунок для выбора чисел в указанном диапазоне.                                                                                                               | <input type="range">                                                                                                                    |
| search               | Поле для поиска.                                                                                                                                               | <input type="search">                                                                                                                   |
| tel                  | Для телефонных номеров.                                                                                                                                        | <input type="tel" pattern="[0-9]{3}-[0-9]{2}-[0-9]{3}">                                                                                 |
| time                 | Для времени.                                                                                                                                                   | <input type="time">                                                                                                                     |
| url                  | Для веб-адресов.                                                                                                                                               | <input type="url">                                                                                                                      |
| month                | Выбор месяца.                                                                                                                                                  | <input type="month">                                                                                                                    |
| week                 | Выбор недели.                                                                                                                                                  | <input type="week">                                                                                                                     |

---

**select**

[Про select](http://htmlbook.ru/html/select)

| Атрибут   | Описание                                                                             |
| --------- | ------------------------------------------------------------------------------------ |
| accesskey | Позволяет перейти к списку с помощью некоторого сочетания клавиш.                    |
| autofocus | Устанавливает, что список получает фокус после загрузки страницы.                    |
| disabled  | Блокирует доступ и изменение элемента.                                               |
| form      | Связывает список с формой.                                                           |
| multiple  | Позволяет одновременно выбирать сразу несколько элементов списка.                    |
| name      | Имя элемента для отправки на сервер или обращения через скрипты.                     |
| required  | Список обязателен для выбора перед отправкой формы.                                  |
| size      | Количество отображаемых строк списка.                                                |
| tabindex  | Определяет последовательность перехода между элементами при нажатии на клавишу `Tab` |

<tr valign="top">
	<td align="center">
		<select name="select" size="3" multiple="multiple">
			<option selected="selected">Чебурашка
			</option><option>Крокодил Гена</option>
			<option>Шапокляк</option>
			<option>Крыса Лариса</option>
		</select>
	</td>
	<td align="center">
		<select name="select2">
			<option selected="selected">Выберите героя</option>
			<option>Чебурашка</option>
			<option>Крокодил Гена</option>
			<option>Шапокляк</option>
			<option>Крыса Лариса</option>
		</select>
	</td>
</tr>

---

**button**

`button` отличается от `<input type="button">` тем что в него можно вставлять различный контент(фотки,gif)

[Про button](http://htmlbook.ru/html/button/type)

| Тег           | Описание                                                                              |
| ------------- | ------------------------------------------------------------------------------------- |
| value         | Значение кнопки, которое будет отправлено на сервер или прочитано с помощью скриптов. |
| type="submit" | Отправить данные на сервер                                                            |

<form action="">
	<p><input type="text" name="user"></p>
	<p><button type="reset">Очистить форму <img src="https://clck.ru/YUarz" alt="Фото" width="64"  height="64">  </button> 
		<button type="submit">Отправить форму</button></p>
</form>

---

**textarea**

[Про textarea](http://htmlbook.ru/html/textarea)

| Атрибут     | Описание                                                                           |
| ----------- | ---------------------------------------------------------------------------------- |
| accesskey   | Переход к полю с помощью сочетания клавиш.                                         |
| autofocus   | Автоматическое получение фокуса.                                                   |
| cols        | Ширина поля в символах.                                                            |
| disabled    | Блокирует доступ и изменение элемента.                                             |
| form        | Связывает текстовое поле с формой по её идентификатору.                            |
| maxlength   | Максимальное число введенных символов.                                             |
| name        | Имя поля, предназначено для того, чтобы обработчик формы мог его идентифицировать. |
| placeholder | Указывает замещающийся текст.                                                      |
| readonly    | Устанавливает, что поле не может изменяться пользователем.                         |
| required    | Обязательное для заполнения поле.                                                  |
| rows        | Высота поля в строках текста.                                                      |
| tabindex    | Порядок перехода между элементами при нажатии на клавишу Tab.                      |
| wrap        | Параметры переноса строк.                                                          |

<form method="post">
	<p><b>Введите ваш отзыв:</b></p>
	<p><textarea rows="10" cols="45" name="text"></textarea></p>
	<p><input type="submit" value="Отправить"></p>
</form>

### ModelForm не связанные с БД

ModelForm не связанные с БД - относительно сложнее создавать чем `html` формы. Поэтому лучше использовать стандартные тег `form` для `html`

- [Формы не свзяннаые с моделью](https://www.youtube.com/watch?v=u37FXeVQIpU&t=873s)
- [Форма для добавления записей в БД](https://www.youtube.com/watch?v=8QnMxrNT0-8&list=PLDyJYA6aTY1nZ9fSGcsK4wqeu-xaJksQQ&index=12)

### `Ajax` = Асинхронная отправка форм

Если нужно отправлять данные на сервер не перезагружая страницу, надо использовать асинхронные `ajax` веб-запросы. Для работы в с `ajax` веб-запрсами используйте библиотеку `JQuery`.

---

В этом примере мы перехватываем синхронную отправку формы, и делаем асинхронный запрос. Плюс мы отправляем имя формы. Чтобы на сервере как-нибудь разграничить запросы. (Например добавить товар в корзину, удалить товар из корзины)

```js
//   Когда `html`  документ  загружен, создаем  функцию  для  обработки  нажатия
$(document).ready(function () {
    // Перехватываем отправку формы
    $('.КлассФормы').submit(function () {

        // Сериализуем данные из формы и имя формы.
        const dataVAr = $(this).serialize() + '&flag=' + $(this).attr('name')

        // Отладочная информация
        console.log("ClickButtonBasket : ")
        console.log($(this).serialize())
        console.log($(this).attr('method'))
        console.log($(this).attr('action'))
        console.log($(this).attr('name'))
        console.log(dataVAr)


        // Отправляем `ajax` запрос
        $.ajax({
            // Тело сообщения
            method: $(this).attr('method'), // Берем метод из формы
            url: $(this).attr('action'), // Берем url из формы
            data: dataVAr, // Данные на сервер


            // Если при отправке возникли ошибки
            error: function (response) {
                const exceptionVar = "Ошибка отправки" + response
                alert(exceptionVar);
                console.log(exceptionVar)
            }
        }).done(function (msg) { // Получаем ответ от сервера, и обрабатываем его.
            alert(msg)
            console.log(msg)
        });

        // Остановить перезагрузку страницы
        return false;
    });
})
```

```html
<form class="КлассФормы" name="ФлагДляРаличия" method="post" action="{% url 'URL_Сервера' %}" >
    {% csrf_token %}
    <input type="hidden" name="id-product" value="{{ product_obj.pk }}">
    <input type="submit" class="otpravka" value="В корзину">
</form>
```

# `models.py` = Модели базы данных

Структура БД

В `Django` есть удобный инструмент для работы с БД, он использует принципы `ORM`. Класс в котором реализована логика работы базы данных, называется моделью БД, и соответственно эти классы должны храниться в файле `models.py`. Для того чтобы из ваших моделей создать реальные базы данных, нужно создать миграцию, а потом её применить.

> `Миграции` - это описание изменений, которые вы хотите внести в таблицы базы данных.

> `ORM`(объектно-реляционное отображение) = технология программирования, которая связывает базы данных с концепциями объектно-ориентированных языков программирования

```python
from django.db import models

# Create your models here.
from django.urls import reverse


class NameDataBase(models.Model):
	"""
	Место для столбцов таблицы. Создаются как статические атрибуты
	"""

    def __str__(self):
        """
        Для отображение в текстовом виде для админ панели, и консоли.
        """
        return str(self.pk)

    def get_absolute_url(self):
        """
        Для получения ссылки записи в Html и отображение в админ панели.
        """
        return reverse("#", kwargs={"": self.pk})

    class Meta:
        """
        Вспомогательный класс для админ панели.
        """
        verbose_name = "NameDataBase"  # Имя таблицы в единственном числе
        verbose_name_plural = "NameDataBases"  # Имя таблицы во множественном числе
        ordering = ["pk", ]  # Сортировать записи по указанным столбцам (можно указывать несколько столбцов)
```

## Поля для модели

[Источник](https://djbook.ru/rel3.0/ref/models/fields.html)

### Типы полей

| Тип поля                                             | Описание                                                                                                                                       | Краткое имя | Шаблон                                                                                                                             |
| ---------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------- | ----------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| CharField(`max_length=None`)                         | Поле для хранения строк указанной длинны.                                                                                                      | mchar       | `$name_var$ = models.CharField(max_length=$len$, db_column="$NameColumn$", verbose_name="$NameColumn$", help_text="$NameColumn$")` |
| TextField()                                          | Неограниченное текстовое поле                                                                                                                  | mtext       | `$name_var$ = models.TextField(db_column="$NameColumn$", verbose_name="$NameColumn$", help_text="$NameColumn$")`                   |
| DateField(`auto_now=False, auto_now_add=False,`)     | Для хранения только даты. `auto_now` авто обновления даты при изменении записи, `auto_now_add` авто установка текущей даты при создании записи | mdata       | `$name_var$ = models.DateField(db_column="$NameColumn$", verbose_name="$NameColumn$", help_text="$NameColumn$")`                   |
| DateTimeField(`auto_now=False, auto_now_add=False,`) | То же самое что `DateField`, плюс также хранит часы/минуты/секунды.                                                                            | mtime       | `$name_var$ = models.DateTimeField(db_column="$NameColumn$", verbose_name="$NameColumn$", help_text="$NameColumn$")`               |
| IntegerField()                                       | Число от -2147483648 - 2147483647                                                                                                              | mint        | `$name_var$ = models.IntegerField(db_column="$NameColumn$", verbose_name="$NameColumn$", help_text="$NameColumn$")`                |
| PositiveIntegerField()                               | Число от 0 - 2147483647                                                                                                                        | mpint       | `$name_var$ = models.PositiveIntegerField(db_column="$NameColumn$", verbose_name="$NameColumn$", help_text="$NameColumn$")`        |

### Общие параметры для полей модели БД

| Аргумент         | Описание                                                                                                                                |
| ---------------- | --------------------------------------------------------------------------------------------------------------------------------------- |
| `null`           | Пусто значение равно `NULL`                                                                                                             |
| `blank`          | Поле может быть пустым                                                                                                                  |
| `unique`         | Поля должно быть уникальным в своем столбце                                                                                             |
| `db_column`      | Имя колонки в базе данных.                                                                                                              |
| `verbose_name`   | Имя колонки в админ панели.                                                                                                             |
| `db_index`       | Индексировать столбец для быстрого поиска                                                                                               |
| `default`        | Значение по умолчанию, можно указать как переменную, так и функцию                                                                      |
| `editable`       | При `False`, поле не будет отображаться в админке                                                                                       |
| `error_messages` | Позволяет переопределить сообщения ошибки для поля                                                                                      |
| `help_text`      | Подсказка, отображаемая под полем в интерфейсе администратора. Это полезно для описания поля, даже если модель не используется в форме. |
| `primary_key`    | При `True` это поле будет первичным ключом.                                                                                             |
| `validators`     | Список валидаторов для поля                                                                                                             |

### Валидаторы для поля модели БД

Можно создавать свои валидаторы, для этого нужно вызвать исключение `ValidationError`
если данные не верны.

```python
from django.core.exceptions import ValidationError
from django.utils.translation import gettext_lazy as _
from django.db import models

def validate_even(value):
    if value % 2 != 0:
        raise ValidationError(
            _('%(value)s is not an even number'),
            params={'value': value},
        )

class MyModel(models.Model):
    even_field = models.IntegerField(validators=[validate_even])
```

---

Список стандартных валидаторов. [Валидаторы Django](https://djbook.ru/rel3.0/ref/validators.html#module-django.core.validators "Ссылка на этот заголовок")

| Название                                | Описание                    |
| --------------------------------------- | --------------------------- |
| `RegexValidator`                        | Регулярные выражения        |
| `EmailValidator`                        | Проверка корректности почты |
| `URLValidator`                          | Проверка корректности URL   |
| `validate_slug`                         | Только буквы цифры `-` `_`  |
| `validate_unicode_slug`                 |                             |
| `validate_ipv4_address`                 |                             |
| `validate_ipv6_address`                 |                             |
| `validate_ipv46_address`                |                             |
| `validate_comma_separated_integer_list` |                             |
| `int_list_validator`                    |                             |
| `MaxValueValidator`                     | Максимальное значение       |
| `MinValueValidator`                     | Минимальное значение        |
| `MaxLengthValidator`                    | Максимальная длина          |
| `MinLengthValidator`                    | Минимальная длина           |
| `DecimalValidator`                      |                             |
| `FileExtensionValidator`                |                             |
| `validate_image_file_extension`         |                             |
| `ProhibitNullCharactersValidator`       |                             |

## CRUD !!!

### Create

### Read

- Чтение из базы данных ленивое, то есть мы считываем данные из БД только когда к ним обращаемся (в шаблоне или через цикл, и тд.).
- Ниже указанные методы, на самом деле генерируют `Sql` запросы в зависимости от БД которой вы используете.
- Для того чтобы хранить `Sql` запросы, и генерировать их, `Django` использует `QuerySet` [Про QuerySet](https://docs.djangoproject.com/en/3.2/ref/models/querysets/)

| Команда                                  | Описание                                                                             | Краткое имя | Шаблон                   |
| ---------------------------------------- | ------------------------------------------------------------------------------------ | ----------- | ------------------------ |
| `ВашаМодель`.objects.all() -> `QuerySet` | Получить все записи.                                                                 | dall        | `$db$.objects.all()`     |
| `QuerySet`.order_by(`"Колонка_1"`)       | Отсортировать по указанным колонкам. Знак `-` в начале сортирует в обратном порядке. | dsort       | `.order_by("$Column$",)` |
| `QuerySet`.values(`"Колонка_1"`)         | Взять только указанные колонки.                                                      | dval        | `.values("$Column$",)`   |
| `QuerySet`.[`start:stop:steep`]          | Используйте сайлы, для того чтобы ограничить количество выводимых записей            |             |                          |
|                                          |                                                                                      |             |                          |

### Upadate

### Delete

## Формы связанные с моделью БД

Если вам нужно создать форму для заполнения данных БД. То быстрее всего это сделать через формы `ModelForm` [+Все методы форм](https://docs.djangoproject.com/en/3.2/topics/forms/modelforms/).

Для начало на нужно создать файл `app/forms.py`. В нем буду храниться наши шаблоны форм.

```python
from typing import Tuple, Any

from django import forms
from django.core.handlers.wsgi import WSGIRequest

from .models import Product


class ProductForm(forms.ModelForm):

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)

        # Пример установки параметров поля. Во время создания формы
        # self.fields['Имя'].Атрибут = "Значение"

    class Meta:
        """
        Класс отвечает за логику связи модели БД с формой.
        """

        # Установить связь с моделью БД
        model = Product

        # Какие поля нужно отобразить в форме
        fields = [
            "name_product",
            "shot_description",
            "star",
            "rating",
            "details_description", ]

        # Какие паля нужно исключить из формы
        # exclude = []

        # Если вам нужно задать атрибуты для html формы, то сделайте это здесь.
        widgets = {
            "name": forms.Textarea(attrs={"cols": 10, "rows": 1}),
        }

    @classmethod
    def save_from_form(cls, request: WSGIRequest, true_method="POST") -> Tuple[bool, Any]:
        """
        Метод для верификации и сохранения данных, из формы, в БД. Вызывать вручную.
        """
        """
        def index(request:WSGIRequest):
            form = AddPost.create_form(request)
            context = {"form": form[1], ... }
            return render(request, template_name="Name_app/Name.html", context=context, )
        """
        if request.method == true_method:  # Проверим метод запроса с необходимым методом
            form = cls(request.POST)  # Если метод подходящий, то создаем объект формы
            if form.is_valid():  # Проверим валидность данных из формы
                form.save()  # Если данные корректны, то сохранить данные в БД
                return True, ""  # Возвращаем заглушку
            return False, form  # Если валидация не пройдена, то вернем форму с сообщениями об ошибках
        else:
            return False, cls()  # Если метод не подходящий, то вернем форму для html шаблона
```

`app/views.py` Использование в функции представлении

```python
def form_test(request: WSGIRequest):
    form = ProductForm.save_from_form(request)

    context = {
        "form": form[1]
    }
    return render(request,
                  template_name="myapp/form_test.html",
                  context=context, )
```

`app/templates/app/form_test.html` Использование в `html` шаблоне

```js
<div class="myform">
    <form method="post" name="MyForm"
          action=""
          accept-charset="UTF-8"
          autocomplete="on"
          target="_self"
          enctype="application/x-www-form-urlencoded"> {% csrf_token %}


        {% for f in form %}
            <label>
                {{ f.label }} <br>
                {{ f }}
            </label>{{ f.errors }} <br>

        {% endfor %}

        <input type="submit">
    </form>
</div>
```

## `PostgreSQL`

### Подключение `PostgreSQL`

### Использование

# `admin.py` = Django Admin панель

## Создать Admin пользователя

Подготовка:

1. Установить русский язык для админ панель

    `Nmae_proj/settings.py`

    ```python
    LANGUAGE_CODE = 'ru'
    ```

1. Создать профиль админа

    ```bush
    python manage.py createsuperuser
    ```

1. Зарегистрировать модель в `ИмяПриложения/admin.py`

    ```python
    from django.contrib import admin
    from .models import <ИМЯ_МОДЕЛИ_БД1>, <ИМЯ_МОДЕЛИ_БД2>

    admin.site.register(<ИМЯ_МОДЕЛИ_БД1>)
    admin.site.register(<ИМЯ_МОДЕЛИ_БД2>)
    ```

1. Войти в админ панель, по стандарту это `URL` = `http://<domen>/admin/`

## Регистрация и настройка модели БД

У нас есть много настроек отображения данных в админ панели `Django`. [Все методы для ModelAdmin](https://docs.djangoproject.com/en/3.2/ref/contrib/admin/#modeladmin-options)

`app/admin.py`

```python
from django.contrib import admin
from .models import *


@admin.register($NameModel$) # Регестрируем модель БД, с классом `admin.ModelAdmin`
class $NameModel$Admin(admin.ModelAdmin):
    list_display = ("$Any1$")  # Имя столбца которые мы хотим видеть в админ панели
    list_display_links = ("$Any2$")  # Указать имя столбца через которое можно перейти редактированию записи
    search_fields = ("$Any3$")  # Указать по каким столбцам можно делать поиск
    list_editable = ("$Any4$")  # Столбцы которые можно редактировать не открывая всю запись
    list_filter = ("$Any4$")  # Столбцы, по которым можно фильтровать записи
	date_hierarchy = "$DataCreate$" # Поля в котром содержится дата создания

    # prepopulated_fields = {"slug": ("name",)}  # Авто заполнение слага URL на основе столбца
    # readonly_fields = (...,)  # Поля которые можно только смотреть, но не редактировать.
    # fields = (...,)  # Порядок отображения полей при редактировании записи

	 save_on_top = False  # Панель с удаление/созданием записи вверху редактирования запси.


    def get_html_photo(self, obj):
        """
		Метод для вывода миниатюр изображений.
		После этого можно указывать в `list_display=("get_html_photo", )`
		"""
        if obj.image_product:
            return mark_safe(f"<img src='{obj.image_product.url}' width=150 height=150>")

    get_html_photo.short_description = "$Any5$" # Имя столбца миниатюрой

```

Так же можно зарегистрировать только модель

```python
admin.site.register(NameTable)
```

# `apps.py` = Настройки для приложения

В этом файле нужно создавать настройки только для проекта.

```python
from django.apps import AppConfig


class MyappConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'myapp' # Полный путь к приложению
	verbose_name = "$NameAppAdmin$" # Красивое имя приложения в админ панели
```

# Авторизация !!!

## Регистрация пользователь

Мы будем использовать стандартную модель `Django` для регистрации пользователей. А для регистрации переопределим стандартную форму `UserCreationForm`

![UserCreationForm](_attachments/Pasted%20image%2020211102002931.png)

---

Пример класса представления для регистрации

```python
from django.contrib.auth import login
from django.views.generic import CreateView


class RegisterUserViewCreateView(CreateView):
	form_class = RegisterForm  # Наша форма регистрации
	template_name = "profile_user/register_user.html"  # Путь к шаблону `html`
	http_method_names = ["get", "post", ]  # Список методов HTTP, которые обрабатывает класс.
	success_url = reverse_lazy("profile_user")  # URL-адрес для перенаправления после успешной обработки формы.


	def form_valid(self, form):
		"""
		Вызнается при успешной валидации формы.
		- При успешной валидации перенаправляем в профиль
		"""
		user = form.save() # Сохраняем форму
		login(self.request, user) # Входим в профиль
		return redirect("profile_user") # Перенаправляем на станицу
```

Переопределяем стандартную форму регистрации `App/forms.py`

```python
from django import forms
from django.contrib.auth.forms import UserCreationForm
from django.contrib.auth.models import User


class RegisterForm(UserCreationForm):
	"""
	Переопределяем стандартную форму регистрации
	"""

	username = forms.CharField(
			label="Логин",
			widget=forms.TextInput(attrs={"class": "form-class"}))
	first_name = forms.CharField(
			label="Имя",
			widget=forms.TextInput(attrs={"class": "form-class"}))
	last_name = forms.CharField(
			label="Фамилия",
			widget=forms.TextInput(attrs={"class": "form-class"}))
	email = forms.EmailField(
			label="Почта",
			widget=forms.EmailInput(attrs={"class": "form-class"}))
	password1 = forms.CharField(
			label="Пароль",
			widget=forms.PasswordInput(attrs={"class": "form-class"}))
	password2 = forms.CharField(
			label="Повтор пароля",
			widget=forms.PasswordInput(attrs={"class": "form-class"}))

	class Meta:
		# Установить связь с стандартной модель пользователей в `django`
		model = User
		# Какие поля нужно отобразить в форме
		fields = (
				"username",
				"first_name",
				"last_name",
				"email",
				"password1",
				"password2",
		)
```

Шаблон `html`

```html
{% extends "myapp/index_main.html" %}
{% load static %}


{% block BODY %}
    {{ block.super }}
    {# Подклюить стили для формы регистрации #}
    <link href="{% static 'profile_user/css/profile.css' %}" rel="stylesheet" type="text/css">

    {# Блок с формой регистрации#}
    <div class="register-box">
        {# Форма регистрации#}
        <form method="post">
            {% csrf_token %}

            {% for f in form %}
                {# Поле формы#}
                <div class="form-profile-input">
                    {# Названия поля#}
                    <div class="form-label">
                        <label for="{{ f.id_for_label }}"> {{ f.label }}:</label>
                    </div>
                    {# Поле ввода#}
                    <div class="form-input">
                        {{ f }}
                    </div>
                    {# Уведомление об ошибки заполнения поля формы#}
                    <div class="form-error">
                        {{ f.errors }}
                    </div>
                </div>
            {% endfor %}

            {# Кнопка отправки формы #}
            <div class="profile-button">
                <button type="submit">Зарегистрировать</button>
            </div>
        </form>
    </div>
{% endblock BODY %}
```

Стили для регистрации

```css
.register-box {
    font-size: 20px;
    width: 50%;
    max-width: 1000px;
    min-width: 300px;
    margin-left: 100px;
}

.form-error {
    display: inline-block;
    color: var(--ColorError);
}

.form-input {
    display: inline-block;
}

.form-box {

}

.form-register-input {
    padding-top: 15px;
}

.register-button {
    margin-top: 30px;


}

.register-button button {
    padding: 8px;
    border-radius: 4px;
    border: var(--TwoColorText);
    background: var(--TwoColorText);
    color: var(--ThreeBg);
}

.register-button button:hover {
    box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.5);
}
```

## Аутентифицировать пользователя

Будем использовать **Миксин** `LoginRequiredMixin` для реализации аутентифицировать пользователя. Данные об авторизации пользователя находятся в `request.user`.

- [Использование системы аутентификации пользователя](https://djbook.ru/rel3.0/topics/auth/default.html)
- [Этот документ предоставляет справочные материалы по API для компонентов Django's система аутентификации.](https://docs.djangoproject.com/en/3.2/ref/contrib/auth/)

---

Проверка аутентифицировать в `Python`. Пример применения миксина `LoginRequiredMixin`

```python
from django.contrib.auth.mixins import LoginRequiredMixin

class ProfileView(LoginRequiredMixin, View):
	...
	...

	# Перенаправить на указанную страницу если пользователь не авторизован
	login_url = reverse_lazy("login_user")

	...
	...

```

---

Проверка аутентифицировать в шаблоне `html`. Ключевое имя `user.is_authenticated `

```html
{# Если пользователь авторизован то показываем Профиль и Выход #}
{% if user.is_authenticated %}
	...

{# Если пользователь НЕ авторизован то показываем Вход и Регистрацию #}
{% else %}
	...

{% endif %}
```

---

Данные о пользователи

```html
{% extends "myapp/index_main.html" %}
{% load static %}

{% block BODY %}
    {{ block.super }}
    {# Подклюить стили для формы регистрации #}
    <link href="{% static 'profile_user/css/profile.css' %}" rel="stylesheet" type="text/css">

    {# Блок  пользоватлея #}
    <div class="profile-box">
        <p> Ник: {{ user.username }}</p>
        <p> Имя: {{ user.last_name }}</p>
        <p> Фамилия: {{ user.first_name }}</p>
        <p> Поное имя: {{ user.get_full_name }}</p>
        <p> Группа: {{ user.groups }}</p>
        <p> Почта: {{ user.email }}</p>
        <p> Время последнего входа: {{ user.last_login }}</p>
        <p> Время создания профиля: {{ user.date_joined }}</p>
        <p> Это профиль админа?: {{ user.is_superuser }}</p>
    </div>
{% endblock BODY %}
```

| Метод                 | Описание                      |
| --------------------- | ----------------------------- |
| user.is_anonymous     | Это анонинам ?                |
| user.is_superuser     | Это админ ?                   |
| user.is_authenticated | Пользователь аутентифицирован |
| user.date_joined      | Дата и время создания профиля |
| user.last_login       | Время последнего входа        |
| user.email            | Почта                         |
| user.groups           | Группа                        |
| user.get_full_name    | Имя и фамилия                 |
| user.first_name       | Фамилия                       |
| user.last_name        | Имя                           |
| user.username         | Ник                           |

## Login пользователя

Для входа на сайт будет переопределять стандартную форму `AuthenticationForm`

![AuthenticationForm](_attachments/Pasted%20image%2020211102005403.png)

---

Класс представляем для входа

```python
class LoginUserView(LoginView):
	template_name = "profile_user/login_user.html"  # Путь к шаблону `html`
	form_class = LoginUserForm  # Форма аутентификации
	http_method_names = ["get", "post", ]  # Список методов HTTP, которые обрабатывает класс.

	def get_success_url(self):
		"""
		При успешном входе перенаправить на указанную страницу
		"""
		return reverse_lazy("profile_user")
```

Переопределим стандартную форму `AuthenticationForm` для входа `App/forms.py`

```python
from django import forms
from django.contrib.auth.forms import AuthenticationForm


class LoginUserForm(AuthenticationForm):
	username = forms.CharField(label="Логин",
	                           widget=forms.TextInput(attrs={'autofocus': True}))
	password = forms.CharField(label="Пароль", strip=False,
	                           widget=forms.PasswordInput(attrs={'autocomplete': 'current-password'}), )
```

Шаблон входа. Стили взяты из регистрации.

```html
{% extends "myapp/index_main.html" %}
{% load static %}
{% block BODY %}
    {{ block.super }}
    {# Подклюить стили для формы регистрации #}
    <link href="{% static 'profile_user/css/profile.css' %}" rel="stylesheet" type="text/css">

    {# Блок с формой регистрации#}
    <div class="register-box">

        <div class="form-error">{{ form.non_field_errors }}</div>


        <form method="post">
            {% csrf_token %}
            {% for f in form %}
                {# Поле формы#}
                <div class="form-profile-input">
                    {# Названия поля#}
                    <div class="form-label">
                        <label for="{{ f.id_for_label }}"> {{ f.label }}:</label>
                    </div>
                    {# Поле ввода#}
                    <div class="form-input">
                        {{ f }}
                    </div>
                    {# Уведомление об ошибки заполнения поля формы#}
                    <div class="form-error">
                        {{ f.errors }}
                    </div>
                </div>
            {% endfor %}

            {# Кнопка отправки формы #}
            <div class="profile-button">
                <button type="submit">Войти</button>
            </div>
        </form>
    </div>
{% endblock BODY %}
```

## Logout пользователя

Выйти из профиля очень прост нужно создать одну функцию представления которая, вызовет `from django.contrib.auth import logout`

```python
from django.contrib.auth import logout

def logout_user(request: WSGIRequest):
	"""
	При выходе из профиля вся сессия отчищается !
	"""
	logout(request)  # Стандартная функция выхода в `Django`
	return redirect("login_user")  # Перенаправить на страницу после выхода
```

# Тестирование
